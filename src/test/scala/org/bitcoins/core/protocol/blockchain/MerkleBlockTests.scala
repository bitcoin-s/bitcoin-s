package org.bitcoins.core.protocol.blockchain

import org.bitcoins.core.bloom._
import org.bitcoins.core.crypto.{DoubleSha256Digest, ECPublicKey}
import org.bitcoins.core.number.UInt32
import org.bitcoins.core.protocol.transaction.TransactionOutPoint
import org.bitcoins.core.util.{BitcoinSUtil, _}
import org.scalatest.{FlatSpec, MustMatchers}

/**
  * Created by chris on 8/9/16.
  */
class MerkleBlockTests extends FlatSpec with MustMatchers {

  "MerkleBlocks" must "create merkle block from a block and a bloom filter" in {
    val block = Block("0100000090f0a9f110702f808219ebea1173056042a714bad51b916cb6800000000000005275289558f51c9966699404ae2294730c3c9f9bda53523ce50e9b95e558da2fdb261b4d4c86041b1ab1bf930901000000010000000000000000000000000000000000000000000000000000000000000000ffffffff07044c86041b0146ffffffff0100f2052a01000000434104e18f7afbe4721580e81e8414fc8c24d7cfacf254bb5c7b949450c3e997c2dc1242487a8169507b631eb3771f2b425483fb13102c4eb5d858eef260fe70fbfae0ac00000000010000000196608ccbafa16abada902780da4dc35dafd7af05fa0da08cf833575f8cf9e836000000004a493046022100dab24889213caf43ae6adc41cf1c9396c08240c199f5225acf45416330fd7dbd022100fe37900e0644bf574493a07fc5edba06dbc07c311b947520c2d514bc5725dcb401ffffffff0100f2052a010000001976a914f15d1921f52e4007b146dfa60f369ed2fc393ce288ac000000000100000001fb766c1288458c2bafcfec81e48b24d98ec706de6b8af7c4e3c29419bfacb56d000000008c493046022100f268ba165ce0ad2e6d93f089cfcd3785de5c963bb5ea6b8c1b23f1ce3e517b9f022100da7c0f21adc6c401887f2bfd1922f11d76159cbc597fbd756a23dcbb00f4d7290141042b4e8625a96127826915a5b109852636ad0da753c9e1d5606a50480cd0c40f1f8b8d898235e571fe9357d9ec842bc4bba1827daaf4de06d71844d0057707966affffffff0280969800000000001976a9146963907531db72d0ed1a0cfb471ccb63923446f388ac80d6e34c000000001976a914f0688ba1c0d1ce182c7af6741e02658c7d4dfcd388ac000000000100000002c40297f730dd7b5a99567eb8d27b78758f607507c52292d02d4031895b52f2ff010000008b483045022100f7edfd4b0aac404e5bab4fd3889e0c6c41aa8d0e6fa122316f68eddd0a65013902205b09cc8b2d56e1cd1f7f2fafd60a129ed94504c4ac7bdc67b56fe67512658b3e014104732012cb962afa90d31b25d8fb0e32c94e513ab7a17805c14ca4c3423e18b4fb5d0e676841733cb83abaf975845c9f6f2a8097b7d04f4908b18368d6fc2d68ecffffffffca5065ff9617cbcba45eb23726df6498a9b9cafed4f54cbab9d227b0035ddefb000000008a473044022068010362a13c7f9919fa832b2dee4e788f61f6f5d344a7c2a0da6ae740605658022006d1af525b9a14a35c003b78b72bd59738cd676f845d1ff3fc25049e01003614014104732012cb962afa90d31b25d8fb0e32c94e513ab7a17805c14ca4c3423e18b4fb5d0e676841733cb83abaf975845c9f6f2a8097b7d04f4908b18368d6fc2d68ecffffffff01001ec4110200000043410469ab4181eceb28985b9b4e895c13fa5e68d85761b7eee311db5addef76fa8621865134a221bd01f28ec9999ee3e021e60766e9d1f3458c115fb28650605f11c9ac000000000100000001cdaf2f758e91c514655e2dc50633d1e4c84989f8aa90a0dbc883f0d23ed5c2fa010000008b48304502207ab51be6f12a1962ba0aaaf24a20e0b69b27a94fac5adf45aa7d2d18ffd9236102210086ae728b370e5329eead9accd880d0cb070aea0c96255fae6c4f1ddcce1fd56e014104462e76fd4067b3a0aa42070082dcb0bf2f388b6495cf33d789904f07d0f55c40fbd4b82963c69b3dc31895d0c772c812b1d5fbcade15312ef1c0e8ebbb12dcd4ffffffff02404b4c00000000001976a9142b6ba7c9d796b75eef7942fc9288edd37c32f5c388ac002d3101000000001976a9141befba0cdc1ad56529371864d9f6cb042faa06b588ac000000000100000001b4a47603e71b61bc3326efd90111bf02d2f549b067f4c4a8fa183b57a0f800cb010000008a4730440220177c37f9a505c3f1a1f0ce2da777c339bd8339ffa02c7cb41f0a5804f473c9230220585b25a2ee80eb59292e52b987dad92acb0c64eced92ed9ee105ad153cdb12d001410443bd44f683467e549dae7d20d1d79cbdb6df985c6e9c029c8d0c6cb46cc1a4d3cf7923c5021b27f7a0b562ada113bc85d5fda5a1b41e87fe6e8802817cf69996ffffffff0280651406000000001976a9145505614859643ab7b547cd7f1f5e7e2a12322d3788ac00aa0271000000001976a914ea4720a7a52fc166c55ff2298e07baf70ae67e1b88ac00000000010000000586c62cd602d219bb60edb14a3e204de0705176f9022fe49a538054fb14abb49e010000008c493046022100f2bc2aba2534becbdf062eb993853a42bbbc282083d0daf9b4b585bd401aa8c9022100b1d7fd7ee0b95600db8535bbf331b19eed8d961f7a8e54159c53675d5f69df8c014104462e76fd4067b3a0aa42070082dcb0bf2f388b6495cf33d789904f07d0f55c40fbd4b82963c69b3dc31895d0c772c812b1d5fbcade15312ef1c0e8ebbb12dcd4ffffffff03ad0e58ccdac3df9dc28a218bcf6f1997b0a93306faaa4b3a28ae83447b2179010000008b483045022100be12b2937179da88599e27bb31c3525097a07cdb52422d165b3ca2f2020ffcf702200971b51f853a53d644ebae9ec8f3512e442b1bcb6c315a5b491d119d10624c83014104462e76fd4067b3a0aa42070082dcb0bf2f388b6495cf33d789904f07d0f55c40fbd4b82963c69b3dc31895d0c772c812b1d5fbcade15312ef1c0e8ebbb12dcd4ffffffff2acfcab629bbc8685792603762c921580030ba144af553d271716a95089e107b010000008b483045022100fa579a840ac258871365dd48cd7552f96c8eea69bd00d84f05b283a0dab311e102207e3c0ee9234814cfbb1b659b83671618f45abc1326b9edcc77d552a4f2a805c0014104462e76fd4067b3a0aa42070082dcb0bf2f388b6495cf33d789904f07d0f55c40fbd4b82963c69b3dc31895d0c772c812b1d5fbcade15312ef1c0e8ebbb12dcd4ffffffffdcdc6023bbc9944a658ddc588e61eacb737ddf0a3cd24f113b5a8634c517fcd2000000008b4830450221008d6df731df5d32267954bd7d2dda2302b74c6c2a6aa5c0ca64ecbabc1af03c75022010e55c571d65da7701ae2da1956c442df81bbf076cdbac25133f99d98a9ed34c014104462e76fd4067b3a0aa42070082dcb0bf2f388b6495cf33d789904f07d0f55c40fbd4b82963c69b3dc31895d0c772c812b1d5fbcade15312ef1c0e8ebbb12dcd4ffffffffe15557cd5ce258f479dfd6dc6514edf6d7ed5b21fcfa4a038fd69f06b83ac76e010000008b483045022023b3e0ab071eb11de2eb1cc3a67261b866f86bf6867d4558165f7c8c8aca2d86022100dc6e1f53a91de3efe8f63512850811f26284b62f850c70ca73ed5de8771fb451014104462e76fd4067b3a0aa42070082dcb0bf2f388b6495cf33d789904f07d0f55c40fbd4b82963c69b3dc31895d0c772c812b1d5fbcade15312ef1c0e8ebbb12dcd4ffffffff01404b4c00000000001976a9142b6ba7c9d796b75eef7942fc9288edd37c32f5c388ac00000000010000000166d7577163c932b4f9690ca6a80b6e4eb001f0a2fa9023df5595602aae96ed8d000000008a4730440220262b42546302dfb654a229cefc86432b89628ff259dc87edd1154535b16a67e102207b4634c020a97c3e7bbd0d4d19da6aa2269ad9dded4026e896b213d73ca4b63f014104979b82d02226b3a4597523845754d44f13639e3bf2df5e82c6aab2bdc79687368b01b1ab8b19875ae3c90d661a3d0a33161dab29934edeb36aa01976be3baf8affffffff02404b4c00000000001976a9144854e695a02af0aeacb823ccbc272134561e0a1688ac40420f00000000001976a914abee93376d6b37b5c2940655a6fcaf1c8e74237988ac0000000001000000014e3f8ef2e91349a9059cb4f01e54ab2597c1387161d3da89919f7ea6acdbb371010000008c49304602210081f3183471a5ca22307c0800226f3ef9c353069e0773ac76bb580654d56aa523022100d4c56465bdc069060846f4fbf2f6b20520b2a80b08b168b31e66ddb9c694e240014104976c79848e18251612f8940875b2b08d06e6dc73b9840e8860c066b7e87432c477e9a59a453e71e6d76d5fe34058b800a098fc1740ce3012e8fc8a00c96af966ffffffff02c0e1e400000000001976a9144134e75a6fcb6042034aab5e18570cf1f844f54788ac404b4c00000000001976a9142b6ba7c9d796b75eef7942fc9288edd37c32f5c388ac00000000")
    val hash = DoubleSha256Digest(BitcoinSUtil.flipEndianness(
      "74d681e0e03bafa802c8aa084379aa98d9fcd632ddc2ed9782b586ec87451f20"))
    val filter = BloomFilter(10,0.000001, UInt32.zero, BloomUpdateAll).insert(hash)

    val (merkleBlock,_) = MerkleBlock(block,filter)
    merkleBlock.blockHeader must be (block.blockHeader)

    merkleBlock.partialMerkleTree.extractMatches must be (Seq(hash))
  }

  it must "match and extract to txids inserted into the bloom filter" in {

    val block = Block("0100000090f0a9f110702f808219ebea1173056042a714bad51b916cb68000000000000052752895" +
      "58f51c9966699404ae2294730c3c9f9bda53523ce50e9b95e558da2fdb261b4d4c86041b1ab1bf930901000000010000" +
      "000000000000000000000000000000000000000000000000000000000000ffffffff07044c86041b0146ffffffff0100" +
      "f2052a01000000434104e18f7afbe4721580e81e8414fc8c24d7cfacf254bb5c7b949450c3e997c2dc1242487a816950" +
      "7b631eb3771f2b425483fb13102c4eb5d858eef260fe70fbfae0ac00000000010000000196608ccbafa16abada902780" +
      "da4dc35dafd7af05fa0da08cf833575f8cf9e836000000004a493046022100dab24889213caf43ae6adc41cf1c9396c0" +
      "8240c199f5225acf45416330fd7dbd022100fe37900e0644bf574493a07fc5edba06dbc07c311b947520c2d514bc5725" +
      "dcb401ffffffff0100f2052a010000001976a914f15d1921f52e4007b146dfa60f369ed2fc393ce288ac000000000100" +
      "000001fb766c1288458c2bafcfec81e48b24d98ec706de6b8af7c4e3c29419bfacb56d000000008c493046022100f268" +
      "ba165ce0ad2e6d93f089cfcd3785de5c963bb5ea6b8c1b23f1ce3e517b9f022100da7c0f21adc6c401887f2bfd1922f1" +
      "1d76159cbc597fbd756a23dcbb00f4d7290141042b4e8625a96127826915a5b109852636ad0da753c9e1d5606a50480c" +
      "d0c40f1f8b8d898235e571fe9357d9ec842bc4bba1827daaf4de06d71844d0057707966affffffff0280969800000000" +
      "001976a9146963907531db72d0ed1a0cfb471ccb63923446f388ac80d6e34c000000001976a914f0688ba1c0d1ce182c" +
      "7af6741e02658c7d4dfcd388ac000000000100000002c40297f730dd7b5a99567eb8d27b78758f607507c52292d02d40" +
      "31895b52f2ff010000008b483045022100f7edfd4b0aac404e5bab4fd3889e0c6c41aa8d0e6fa122316f68eddd0a6501" +
      "3902205b09cc8b2d56e1cd1f7f2fafd60a129ed94504c4ac7bdc67b56fe67512658b3e014104732012cb962afa90d31b" +
      "25d8fb0e32c94e513ab7a17805c14ca4c3423e18b4fb5d0e676841733cb83abaf975845c9f6f2a8097b7d04f4908b183" +
      "68d6fc2d68ecffffffffca5065ff9617cbcba45eb23726df6498a9b9cafed4f54cbab9d227b0035ddefb000000008a47" +
      "3044022068010362a13c7f9919fa832b2dee4e788f61f6f5d344a7c2a0da6ae740605658022006d1af525b9a14a35c00" +
      "3b78b72bd59738cd676f845d1ff3fc25049e01003614014104732012cb962afa90d31b25d8fb0e32c94e513ab7a17805" +
      "c14ca4c3423e18b4fb5d0e676841733cb83abaf975845c9f6f2a8097b7d04f4908b18368d6fc2d68ecffffffff01001e" +
      "c4110200000043410469ab4181eceb28985b9b4e895c13fa5e68d85761b7eee311db5addef76fa8621865134a221bd01" +
      "f28ec9999ee3e021e60766e9d1f3458c115fb28650605f11c9ac000000000100000001cdaf2f758e91c514655e2dc506" +
      "33d1e4c84989f8aa90a0dbc883f0d23ed5c2fa010000008b48304502207ab51be6f12a1962ba0aaaf24a20e0b69b27a9" +
      "4fac5adf45aa7d2d18ffd9236102210086ae728b370e5329eead9accd880d0cb070aea0c96255fae6c4f1ddcce1fd56e" +
      "014104462e76fd4067b3a0aa42070082dcb0bf2f388b6495cf33d789904f07d0f55c40fbd4b82963c69b3dc31895d0c7" +
      "72c812b1d5fbcade15312ef1c0e8ebbb12dcd4ffffffff02404b4c00000000001976a9142b6ba7c9d796b75eef7942fc" +
      "9288edd37c32f5c388ac002d3101000000001976a9141befba0cdc1ad56529371864d9f6cb042faa06b588ac00000000" +
      "0100000001b4a47603e71b61bc3326efd90111bf02d2f549b067f4c4a8fa183b57a0f800cb010000008a473044022017" +
      "7c37f9a505c3f1a1f0ce2da777c339bd8339ffa02c7cb41f0a5804f473c9230220585b25a2ee80eb59292e52b987dad9" +
      "2acb0c64eced92ed9ee105ad153cdb12d001410443bd44f683467e549dae7d20d1d79cbdb6df985c6e9c029c8d0c6cb4" +
      "6cc1a4d3cf7923c5021b27f7a0b562ada113bc85d5fda5a1b41e87fe6e8802817cf69996ffffffff0280651406000000" +
      "001976a9145505614859643ab7b547cd7f1f5e7e2a12322d3788ac00aa0271000000001976a914ea4720a7a52fc166c55ff2298e07baf70ae67e1b88ac00000000010000000586c62cd602d219bb60edb14a3e204de0705176f9022fe49a538054fb14abb49e010000008c493046022100f2bc2aba2534becbdf062eb993853a42bbbc282083d0daf9b4b585bd401aa8c9022100b1d7fd7ee0b95600db8535bbf331b19eed8d961f7a8e54159c53675d5f69df8c014104462e76fd4067b3a0aa42070082dcb0bf2f388b6495cf33d789904f07d0f55c40fbd4b82963c69b3dc31895d0c772c812b1d5fbcade15312ef1c0e8ebbb12dcd4ffffffff03ad0e58ccdac3df9dc28a218bcf6f1997b0a93306faaa4b3a28ae83447b2179010000008b483045022100be12b2937179da88599e27bb31c3525097a07cdb52422d165b3ca2f2020ffcf702200971b51f853a53d644ebae9ec8f3512e442b1bcb6c315a5b491d119d10624c83014104462e76fd4067b3a0aa42070082dcb0bf2f388b6495cf33d789904f07d0f55c40fbd4b82963c69b3dc31895d0c772c812b1d5fbcade15312ef1c0e8ebbb12dcd4ffffffff2acfcab629bbc8685792603762c921580030ba144af553d271716a95089e107b010000008b483045022100fa579a840ac258871365dd48cd7552f96c8eea69bd00d84f05b283a0dab311e102207e3c0ee9234814cfbb1b659b83671618f45abc1326b9edcc77d552a4f2a805c0014104462e76fd4067b3a0aa42070082dcb0bf2f388b6495cf33d789904f07d0f55c40fbd4b82963c69b3dc31895d0c772c812b1d5fbcade15312ef1c0e8ebbb12dcd4ffffffffdcdc6023bbc9944a658ddc588e61eacb737ddf0a3cd24f113b5a8634c517fcd2000000008b4830450221008d6df731df5d32267954bd7d2dda2302b74c6c2a6aa5c0ca64ecbabc1af03c75022010e55c571d65da7701ae2da1956c442df81bbf076cdbac25133f99d98a9ed34c014104462e76fd4067b3a0aa42070082dcb0bf2f388b6495cf33d789904f07d0f55c40fbd4b82963c69b3dc31895d0c772c812b1d5fbcade15312ef1c0e8ebbb12dcd4ffffffffe15557cd5ce258f479dfd6dc6514edf6d7ed5b21fcfa4a038fd69f06b83ac76e010000008b483045022023b3e0ab071eb11de2eb1cc3a67261b866f86bf6867d4558165f7c8c8aca2d86022100dc6e1f53a91de3efe8f63512850811f26284b62f850c70ca73ed5de8771fb451014104462e76fd4067b3a0aa42070082dcb0bf2f388b6495cf33d789904f07d0f55c40fbd4b82963c69b3dc31895d0c772c812b1d5fbcade15312ef1c0e8ebbb12dcd4ffffffff01404b4c00000000001976a9142b6ba7c9d796b75eef7942fc9288edd37c32f5c388ac00000000010000000166d7577163c932b4f9690ca6a80b6e4eb001f0a2fa9023df5595602aae96ed8d000000008a4730440220262b42546302dfb654a229cefc86432b89628ff259dc87edd1154535b16a67e102207b4634c020a97c3e7bbd0d4d19da6aa2269ad9dded4026e896b213d73ca4b63f014104979b82d02226b3a4597523845754d44f13639e3bf2df5e82c6aab2bdc79687368b01b1ab8b19875ae3c90d661a3d0a33161dab29934edeb36aa01976be3baf8affffffff02404b4c00000000001976a9144854e695a02af0aeacb823ccbc272134561e0a1688ac40420f00000000001976a914abee93376d6b37b5c2940655a6fcaf1c8e74237988ac0000000001000000014e3f8ef2e91349a9059cb4f01e54ab2597c1387161d3da89919f7ea6acdbb371010000008c49304602210081f3183471a5ca22307c0800226f3ef9c353069e0773ac76bb580654d56aa523022100d4c56465bdc069060846f4fbf2f6b20520b2a80b08b168b31e66ddb9c694e240014104976c79848e18251612f8940875b2b08d06e6dc73b9840e8860c066b7e87432c477e9a59a453e71e6d76d5fe34058b800a098fc1740ce3012e8fc8a00c96af966ffffffff02c0e1e400000000001976a9144134e75a6fcb6042034aab5e18570cf1f844f54788ac404b4c00000000001976a9142b6ba7c9d796b75eef7942fc9288edd37c32f5c388ac00000000")

    val hash1 = DoubleSha256Digest(BitcoinSUtil.flipEndianness("74d681e0e03bafa802c8aa084379aa98d9fcd632ddc2ed9782b586ec87451f20"))
    val hash2 = DoubleSha256Digest(BitcoinSUtil.flipEndianness("dd1fd2a6fc16404faf339881a90adbde7f4f728691ac62e8f168809cdfae1053"))

    val filter = BloomFilter(10,0.000001, UInt32.zero, BloomUpdateAll).insert(hash1).insert(hash2)
    val (merkleBlock,_) = MerkleBlock(block,filter)

    merkleBlock.partialMerkleTree.extractMatches must be (Seq(hash2,hash1))
  }


  it must "match a pubkey on an output for a transaction inside of a block" in {
    //mimics this test case inside of bitcoin core
    //https://github.com/bitcoin/bitcoin/blob/master/src/test/bloom_tests.cpp#L231
    val block = Block("0100000075616236cc2126035fadb38deb65b9102cc2c41c09cdf29fc051906800000000fe7d5e12ef0ff901f6050211249919b1c0653771832b3a80c66cea42847f0ae1d4d26e49ffff001d00f0a4410401000000010000000000000000000000000000000000000000000000000000000000000000ffffffff0804ffff001d029105ffffffff0100f2052a010000004341046d8709a041d34357697dfcb30a9d05900a6294078012bf3bb09c6f9b525f1d16d5503d7905db1ada9501446ea00728668fc5719aa80be2fdfc8a858a4dbdd4fbac00000000010000000255605dc6f5c3dc148b6da58442b0b2cd422be385eab2ebea4119ee9c268d28350000000049483045022100aa46504baa86df8a33b1192b1b9367b4d729dc41e389f2c04f3e5c7f0559aae702205e82253a54bf5c4f65b7428551554b2045167d6d206dfe6a2e198127d3f7df1501ffffffff55605dc6f5c3dc148b6da58442b0b2cd422be385eab2ebea4119ee9c268d2835010000004847304402202329484c35fa9d6bb32a55a70c0982f606ce0e3634b69006138683bcd12cbb6602200c28feb1e2555c3210f1dddb299738b4ff8bbe9667b68cb8764b5ac17b7adf0001ffffffff0200e1f505000000004341046a0765b5865641ce08dd39690aade26dfbf5511430ca428a3089261361cef170e3929a68aee3d8d4848b0c5111b0a37b82b86ad559fd2a745b44d8e8d9dfdc0cac00180d8f000000004341044a656f065871a353f216ca26cef8dde2f03e8c16202d2e8ad769f02032cb86a5eb5e56842e92e19141d60a01928f8dd2c875a390f67c1f6c94cfc617c0ea45afac0000000001000000025f9a06d3acdceb56be1bfeaa3e8a25e62d182fa24fefe899d1c17f1dad4c2028000000004847304402205d6058484157235b06028c30736c15613a28bdb768ee628094ca8b0030d4d6eb0220328789c9a2ec27ddaec0ad5ef58efded42e6ea17c2e1ce838f3d6913f5e95db601ffffffff5f9a06d3acdceb56be1bfeaa3e8a25e62d182fa24fefe899d1c17f1dad4c2028010000004a493046022100c45af050d3cea806cedd0ab22520c53ebe63b987b8954146cdca42487b84bdd6022100b9b027716a6b59e640da50a864d6dd8a0ef24c76ce62391fa3eabaf4d2886d2d01ffffffff0200e1f505000000004341046a0765b5865641ce08dd39690aade26dfbf5511430ca428a3089261361cef170e3929a68aee3d8d4848b0c5111b0a37b82b86ad559fd2a745b44d8e8d9dfdc0cac00180d8f000000004341046a0765b5865641ce08dd39690aade26dfbf5511430ca428a3089261361cef170e3929a68aee3d8d4848b0c5111b0a37b82b86ad559fd2a745b44d8e8d9dfdc0cac000000000100000002e2274e5fea1bf29d963914bd301aa63b64daaf8a3e88f119b5046ca5738a0f6b0000000048473044022016e7a727a061ea2254a6c358376aaa617ac537eb836c77d646ebda4c748aac8b0220192ce28bf9f2c06a6467e6531e27648d2b3e2e2bae85159c9242939840295ba501ffffffffe2274e5fea1bf29d963914bd301aa63b64daaf8a3e88f119b5046ca5738a0f6b010000004a493046022100b7a1a755588d4190118936e15cd217d133b0e4a53c3c15924010d5648d8925c9022100aaef031874db2114f2d869ac2de4ae53908fbfea5b2b1862e181626bb9005c9f01ffffffff0200e1f505000000004341044a656f065871a353f216ca26cef8dde2f03e8c16202d2e8ad769f02032cb86a5eb5e56842e92e19141d60a01928f8dd2c875a390f67c1f6c94cfc617c0ea45afac00180d8f000000004341046a0765b5865641ce08dd39690aade26dfbf5511430ca428a3089261361cef170e3929a68aee3d8d4848b0c5111b0a37b82b86ad559fd2a745b44d8e8d9dfdc0cac00000000")
    val firstTxId = DoubleSha256Digest(BitcoinSUtil.flipEndianness(
      "e980fe9f792d014e73b95203dc1335c5f9ce19ac537a419e6df5b47aecb93b70"))
    val filter = BloomFilter(10, 0.000001, UInt32.zero, BloomUpdateAll).insert(firstTxId)

    val (merkleBlock,_) = MerkleBlock(block,filter)

    merkleBlock.partialMerkleTree.extractMatches must be (Seq(firstTxId))

    // create a new filter with a publilc key
    // This should match the third transaction because it spends the output matched
    // It also matches the fourth transaction, which spends to the pubkey again
    val filterWithPubKey = filter.insert(BitcoinSUtil.decodeHex(
      "044a656f065871a353f216ca26cef8dde2f03e8c16202d2e8ad769f02032cb86a5eb5e56842e92e19141" +
        "d60a01928f8dd2c875a390f67c1f6c94cfc617c0ea45af"))

    val (merkleBlockWithPubKey,_) = MerkleBlock(block,filterWithPubKey)

    val hash1 = DoubleSha256Digest(BitcoinSUtil.flipEndianness("28204cad1d7fc1d199e8ef4fa22f182de6258a3eaafe1bbe56ebdcacd3069a5f"))
    val hash2 = DoubleSha256Digest(BitcoinSUtil.flipEndianness("6b0f8a73a56c04b519f1883e8aafda643ba61a30bd1439969df21bea5f4e27e2"))
    val hash3 = DoubleSha256Digest(BitcoinSUtil.flipEndianness("3c1d7e82342158e4109df2e0b6348b6e84e403d8b4046d7007663ace63cddb23"))

    merkleBlockWithPubKey.partialMerkleTree.extractMatches must be (Seq(firstTxId, hash1,hash2,hash3))
  }

  it must "match a transaction properly with bloom_update_none is set on the bloom filter" in {
    //mimics this test case inside of core
    //https://github.com/bitcoin/bitcoin/blob/master/src/test/bloom_tests.cpp#L286
    val block = Block("0100000075616236cc2126035fadb38deb65b9102cc2c41c09cdf29fc051906800000000fe7d5e12ef0ff901f6050211249919b1c0653771832b3a80c66cea42847f0ae1d4d26e49ffff001d00f0a4410401000000010000000000000000000000000000000000000000000000000000000000000000ffffffff0804ffff001d029105ffffffff0100f2052a010000004341046d8709a041d34357697dfcb30a9d05900a6294078012bf3bb09c6f9b525f1d16d5503d7905db1ada9501446ea00728668fc5719aa80be2fdfc8a858a4dbdd4fbac00000000010000000255605dc6f5c3dc148b6da58442b0b2cd422be385eab2ebea4119ee9c268d28350000000049483045022100aa46504baa86df8a33b1192b1b9367b4d729dc41e389f2c04f3e5c7f0559aae702205e82253a54bf5c4f65b7428551554b2045167d6d206dfe6a2e198127d3f7df1501ffffffff55605dc6f5c3dc148b6da58442b0b2cd422be385eab2ebea4119ee9c268d2835010000004847304402202329484c35fa9d6bb32a55a70c0982f606ce0e3634b69006138683bcd12cbb6602200c28feb1e2555c3210f1dddb299738b4ff8bbe9667b68cb8764b5ac17b7adf0001ffffffff0200e1f505000000004341046a0765b5865641ce08dd39690aade26dfbf5511430ca428a3089261361cef170e3929a68aee3d8d4848b0c5111b0a37b82b86ad559fd2a745b44d8e8d9dfdc0cac00180d8f000000004341044a656f065871a353f216ca26cef8dde2f03e8c16202d2e8ad769f02032cb86a5eb5e56842e92e19141d60a01928f8dd2c875a390f67c1f6c94cfc617c0ea45afac0000000001000000025f9a06d3acdceb56be1bfeaa3e8a25e62d182fa24fefe899d1c17f1dad4c2028000000004847304402205d6058484157235b06028c30736c15613a28bdb768ee628094ca8b0030d4d6eb0220328789c9a2ec27ddaec0ad5ef58efded42e6ea17c2e1ce838f3d6913f5e95db601ffffffff5f9a06d3acdceb56be1bfeaa3e8a25e62d182fa24fefe899d1c17f1dad4c2028010000004a493046022100c45af050d3cea806cedd0ab22520c53ebe63b987b8954146cdca42487b84bdd6022100b9b027716a6b59e640da50a864d6dd8a0ef24c76ce62391fa3eabaf4d2886d2d01ffffffff0200e1f505000000004341046a0765b5865641ce08dd39690aade26dfbf5511430ca428a3089261361cef170e3929a68aee3d8d4848b0c5111b0a37b82b86ad559fd2a745b44d8e8d9dfdc0cac00180d8f000000004341046a0765b5865641ce08dd39690aade26dfbf5511430ca428a3089261361cef170e3929a68aee3d8d4848b0c5111b0a37b82b86ad559fd2a745b44d8e8d9dfdc0cac000000000100000002e2274e5fea1bf29d963914bd301aa63b64daaf8a3e88f119b5046ca5738a0f6b0000000048473044022016e7a727a061ea2254a6c358376aaa617ac537eb836c77d646ebda4c748aac8b0220192ce28bf9f2c06a6467e6531e27648d2b3e2e2bae85159c9242939840295ba501ffffffffe2274e5fea1bf29d963914bd301aa63b64daaf8a3e88f119b5046ca5738a0f6b010000004a493046022100b7a1a755588d4190118936e15cd217d133b0e4a53c3c15924010d5648d8925c9022100aaef031874db2114f2d869ac2de4ae53908fbfea5b2b1862e181626bb9005c9f01ffffffff0200e1f505000000004341044a656f065871a353f216ca26cef8dde2f03e8c16202d2e8ad769f02032cb86a5eb5e56842e92e19141d60a01928f8dd2c875a390f67c1f6c94cfc617c0ea45afac00180d8f000000004341046a0765b5865641ce08dd39690aade26dfbf5511430ca428a3089261361cef170e3929a68aee3d8d4848b0c5111b0a37b82b86ad559fd2a745b44d8e8d9dfdc0cac00000000")
    //first txid in the block
    val hash = DoubleSha256Digest(BitcoinSUtil.flipEndianness("e980fe9f792d014e73b95203dc1335c5f9ce19ac537a419e6df5b47aecb93b70"))
    val filter = BloomFilter(10, 0.000001, UInt32.zero, BloomUpdateNone).insert(hash)

    val (merkleBlock,_) = MerkleBlock(block,filter)

    merkleBlock.partialMerkleTree.extractMatches must be (Seq(hash))

    // Match an output from the second transaction (the pubkey for address 1DZTzaBHUDM7T3QvUKBz4qXMRpkg8jsfB5)
    // This should not match the third transaction though it spends the output matched
    // It will match the fourth transaction, which has another pay-to-pubkey output to the same address
    val pubKey = ECPublicKey("044a656f065871a353f216ca26cef8dde2f03e8c16202d2e8ad769f02032cb86a5eb5e56842e92e19141d60a01928f8dd2c875a390f67c1f6c94cfc617c0ea45af")
    val filterWithPubKey = filter.insert(pubKey.bytes)

    val (merkleBlockWithPubKey,_) = MerkleBlock(block,filterWithPubKey)

    val hash1 = DoubleSha256Digest(BitcoinSUtil.flipEndianness("28204cad1d7fc1d199e8ef4fa22f182de6258a3eaafe1bbe56ebdcacd3069a5f"))
    val hash2 = DoubleSha256Digest(BitcoinSUtil.flipEndianness("3c1d7e82342158e4109df2e0b6348b6e84e403d8b4046d7007663ace63cddb23"))
    merkleBlockWithPubKey.partialMerkleTree.extractMatches must be (Seq(hash,hash1,hash2))

  }

  it must "serialize a merkle block that has a matched transaction inside of it" in {
    //mimics this test case from bitcoin core
    //https://github.com/bitcoin/bitcoin/blob/f17032f703288d43a76cffe8fa89b87ade9e3074/src/test/bloom_tests.cpp#L338
    val block = Block("0100000079cda856b143d9db2c1caff01d1aecc8630d30625d10e8b4b8b0000000000000b50cc069d6a3e33e3ff84a5c41d9d3febe7c770fdcc96b2c3ff60abe184f196367291b4d4c86041b8fa45d630101000000010000000000000000000000000000000000000000000000000000000000000000ffffffff08044c86041b020a02ffffffff0100f2052a01000000434104ecd3229b0571c3be876feaac0442a9f13c5a572742927af1dc623353ecf8c202225f64868137a18cdd85cbbb4c74fbccfd4f49639cf1bdc94a5672bb15ad5d4cac00000000")
    //only tx in the block
    val hash = DoubleSha256Digest(BitcoinSUtil.flipEndianness("63194f18be0af63f2c6bc9dc0f777cbefed3d9415c4af83f3ee3a3d669c00cb5"))
    val filter = BloomFilter(10,0.000001, UInt32.zero, BloomUpdateAll).insert(hash)
    val (merkleBlock,_) = MerkleBlock(block,filter)
    merkleBlock.partialMerkleTree.extractMatches must be (Seq(hash))

    val expectedMerkleBlockHex = "0100000079cda856b143d9db2c1caff01d1aecc8630d30625d10e8b4b8b0000000000000b50cc069d6a3e33e3ff84a5c41d9d3febe7c770fdcc96b2c3ff60abe184f196367291b4d4c86041b8fa45d630100000001b50cc069d6a3e33e3ff84a5c41d9d3febe7c770fdcc96b2c3ff60abe184f19630101"
    val expectedMerkleBlock = MerkleBlock(expectedMerkleBlockHex)
    merkleBlock.blockHeader must be (expectedMerkleBlock.blockHeader)
    merkleBlock.transactionCount must be (expectedMerkleBlock.transactionCount)
    merkleBlock.hashCount must be (expectedMerkleBlock.hashCount)
    merkleBlock.hashes must be (expectedMerkleBlock.hashes)
    merkleBlock.hex must be (expectedMerkleBlockHex)
  }

  it must "mimic the merkle_block_4 test case inside of bitcoin core" in {
    //mimics this test case inside of bitcoin core
    //https://github.com/bitcoin/bitcoin/blob/master/src/test/bloom_tests.cpp#L377
    val block = Block("0100000082bb869cf3a793432a66e826e05a6fc37469f8efb7421dc880670100000000007f16c5962e8bd963659c793ce370d95f093bc7e367117b3c30c1f8fdd0d9728776381b4d4c86041b554b85290701000000010000000000000000000000000000000000000000000000000000000000000000ffffffff07044c86041b0136ffffffff0100f2052a01000000434104eaafc2314def4ca98ac970241bcab022b9c1e1f4ea423a20f134c876f2c01ec0f0dd5b2e86e7168cefe0d81113c3807420ce13ad1357231a2252247d97a46a91ac000000000100000001bcad20a6a29827d1424f08989255120bf7f3e9e3cdaaa6bb31b0737fe048724300000000494830450220356e834b046cadc0f8ebb5a8a017b02de59c86305403dad52cd77b55af062ea10221009253cd6c119d4729b77c978e1e2aa19f5ea6e0e52b3f16e32fa608cd5bab753901ffffffff02008d380c010000001976a9142b4b8072ecbba129b6453c63e129e643207249ca88ac0065cd1d000000001976a9141b8dd13b994bcfc787b32aeadf58ccb3615cbd5488ac000000000100000003fdacf9b3eb077412e7a968d2e4f11b9a9dee312d666187ed77ee7d26af16cb0b000000008c493046022100ea1608e70911ca0de5af51ba57ad23b9a51db8d28f82c53563c56a05c20f5a87022100a8bdc8b4a8acc8634c6b420410150775eb7f2474f5615f7fccd65af30f310fbf01410465fdf49e29b06b9a1582287b6279014f834edc317695d125ef623c1cc3aaece245bd69fcad7508666e9c74a49dc9056d5fc14338ef38118dc4afae5fe2c585caffffffff309e1913634ecb50f3c4f83e96e70b2df071b497b8973a3e75429df397b5af83000000004948304502202bdb79c596a9ffc24e96f4386199aba386e9bc7b6071516e2b51dda942b3a1ed022100c53a857e76b724fc14d45311eac5019650d415c3abb5428f3aae16d8e69bec2301ffffffff2089e33491695080c9edc18a428f7d834db5b6d372df13ce2b1b0e0cbcb1e6c10000000049483045022100d4ce67c5896ee251c810ac1ff9ceccd328b497c8f553ab6e08431e7d40bad6b5022033119c0c2b7d792d31f1187779c7bd95aefd93d90a715586d73801d9b47471c601ffffffff0100714460030000001976a914c7b55141d097ea5df7a0ed330cf794376e53ec8d88ac0000000001000000045bf0e214aa4069a3e792ecee1e1bf0c1d397cde8dd08138f4b72a00681743447000000008b48304502200c45de8c4f3e2c1821f2fc878cba97b1e6f8807d94930713aa1c86a67b9bf1e40221008581abfef2e30f957815fc89978423746b2086375ca8ecf359c85c2a5b7c88ad01410462bb73f76ca0994fcb8b4271e6fb7561f5c0f9ca0cf6485261c4a0dc894f4ab844c6cdfb97cd0b60ffb5018ffd6238f4d87270efb1d3ae37079b794a92d7ec95ffffffffd669f7d7958d40fc59d2253d88e0f248e29b599c80bbcec344a83dda5f9aa72c000000008a473044022078124c8beeaa825f9e0b30bff96e564dd859432f2d0cb3b72d3d5d93d38d7e930220691d233b6c0f995be5acb03d70a7f7a65b6bc9bdd426260f38a1346669507a3601410462bb73f76ca0994fcb8b4271e6fb7561f5c0f9ca0cf6485261c4a0dc894f4ab844c6cdfb97cd0b60ffb5018ffd6238f4d87270efb1d3ae37079b794a92d7ec95fffffffff878af0d93f5229a68166cf051fd372bb7a537232946e0a46f53636b4dafdaa4000000008c493046022100c717d1714551663f69c3c5759bdbb3a0fcd3fab023abc0e522fe6440de35d8290221008d9cbe25bffc44af2b18e81c58eb37293fd7fe1c2e7b46fc37ee8c96c50ab1e201410462bb73f76ca0994fcb8b4271e6fb7561f5c0f9ca0cf6485261c4a0dc894f4ab844c6cdfb97cd0b60ffb5018ffd6238f4d87270efb1d3ae37079b794a92d7ec95ffffffff27f2b668859cd7f2f894aa0fd2d9e60963bcd07c88973f425f999b8cbfd7a1e2000000008c493046022100e00847147cbf517bcc2f502f3ddc6d284358d102ed20d47a8aa788a62f0db780022100d17b2d6fa84dcaf1c95d88d7e7c30385aecf415588d749afd3ec81f6022cecd701410462bb73f76ca0994fcb8b4271e6fb7561f5c0f9ca0cf6485261c4a0dc894f4ab844c6cdfb97cd0b60ffb5018ffd6238f4d87270efb1d3ae37079b794a92d7ec95ffffffff0100c817a8040000001976a914b6efd80d99179f4f4ff6f4dd0a007d018c385d2188ac000000000100000001834537b2f1ce8ef9373a258e10545ce5a50b758df616cd4356e0032554ebd3c4000000008b483045022100e68f422dd7c34fdce11eeb4509ddae38201773dd62f284e8aa9d96f85099d0b002202243bd399ff96b649a0fad05fa759d6a882f0af8c90cf7632c2840c29070aec20141045e58067e815c2f464c6a2a15f987758374203895710c2d452442e28496ff38ba8f5fd901dc20e29e88477167fe4fc299bf818fd0d9e1632d467b2a3d9503b1aaffffffff0280d7e636030000001976a914f34c3e10eb387efe872acb614c89e78bfca7815d88ac404b4c00000000001976a914a84e272933aaf87e1715d7786c51dfaeb5b65a6f88ac00000000010000000143ac81c8e6f6ef307dfe17f3d906d999e23e0189fda838c5510d850927e03ae7000000008c4930460221009c87c344760a64cb8ae6685a3eec2c1ac1bed5b88c87de51acd0e124f266c16602210082d07c037359c3a257b5c63ebd90f5a5edf97b2ac1c434b08ca998839f346dd40141040ba7e521fa7946d12edbb1d1e95a15c34bd4398195e86433c92b431cd315f455fe30032ede69cad9d1e1ed6c3c4ec0dbfced53438c625462afb792dcb098544bffffffff0240420f00000000001976a9144676d1b820d63ec272f1900d59d43bc6463d96f888ac40420f00000000001976a914648d04341d00d7968b3405c034adc38d4d8fb9bd88ac00000000010000000248cc917501ea5c55f4a8d2009c0567c40cfe037c2e71af017d0a452ff705e3f1000000008b483045022100bf5fdc86dc5f08a5d5c8e43a8c9d5b1ed8c65562e280007b52b133021acd9acc02205e325d613e555f772802bf413d36ba807892ed1a690a77811d3033b3de226e0a01410429fa713b124484cb2bd7b5557b2c0b9df7b2b1fee61825eadc5ae6c37a9920d38bfccdc7dc3cb0c47d7b173dbc9db8d37db0a33ae487982c59c6f8606e9d1791ffffffff41ed70551dd7e841883ab8f0b16bf04176b7d1480e4f0af9f3d4c3595768d068000000008b4830450221008513ad65187b903aed1102d1d0c47688127658c51106753fed0151ce9c16b80902201432b9ebcb87bd04ceb2de66035fbbaf4bf8b00d1cfe41f1a1f7338f9ad79d210141049d4cf80125bf50be1709f718c07ad15d0fc612b7da1f5570dddc35f2a352f0f27c978b06820edca9ef982c35fda2d255afba340068c5035552368bc7200c1488ffffffff0100093d00000000001976a9148edb68822f1ad580b043c7b3df2e400f8699eb4888ac00000000")
    val hash = DoubleSha256Digest(BitcoinSUtil.flipEndianness("0a2a92f0bda4727d0a13eaddf4dd9ac6b5c61a1429e6b2b818f19b15df0ac154"))
    val filter = BloomFilter(10,0.000001, UInt32.zero, BloomUpdateAll).insert(hash)

    val (merkleBlock,_) = MerkleBlock(block,filter)
    merkleBlock.partialMerkleTree.extractMatches must be (Seq(hash))

    val hash2 = DoubleSha256Digest(BitcoinSUtil.flipEndianness("02981fa052f0481dbc5868f4fc2166035a10f27a03cfd2de67326471df5bc041"))
    val filter2 = filter.insert(hash2)
    val (merkleBlock2,_) = MerkleBlock(block,filter2)

    merkleBlock2.partialMerkleTree.extractMatches must be (Seq(hash2,hash))
  }

  it must "update only p2pk constants in the bloom filter when the BloomUpdateP2PKOnly flag is set" in {
    //mimics this test case inside of core
    //https://github.com/bitcoin/bitcoin/blob/master/src/test/bloom_tests.cpp#L423
    val block = Block("0100000082bb869cf3a793432a66e826e05a6fc37469f8efb7421dc880670100000000007f16c5962e8bd963659c793ce370d95f093bc7e367117b3c30c1f8fdd0d9728776381b4d4c86041b554b85290701000000010000000000000000000000000000000000000000000000000000000000000000ffffffff07044c86041b0136ffffffff0100f2052a01000000434104eaafc2314def4ca98ac970241bcab022b9c1e1f4ea423a20f134c876f2c01ec0f0dd5b2e86e7168cefe0d81113c3807420ce13ad1357231a2252247d97a46a91ac000000000100000001bcad20a6a29827d1424f08989255120bf7f3e9e3cdaaa6bb31b0737fe048724300000000494830450220356e834b046cadc0f8ebb5a8a017b02de59c86305403dad52cd77b55af062ea10221009253cd6c119d4729b77c978e1e2aa19f5ea6e0e52b3f16e32fa608cd5bab753901ffffffff02008d380c010000001976a9142b4b8072ecbba129b6453c63e129e643207249ca88ac0065cd1d000000001976a9141b8dd13b994bcfc787b32aeadf58ccb3615cbd5488ac000000000100000003fdacf9b3eb077412e7a968d2e4f11b9a9dee312d666187ed77ee7d26af16cb0b000000008c493046022100ea1608e70911ca0de5af51ba57ad23b9a51db8d28f82c53563c56a05c20f5a87022100a8bdc8b4a8acc8634c6b420410150775eb7f2474f5615f7fccd65af30f310fbf01410465fdf49e29b06b9a1582287b6279014f834edc317695d125ef623c1cc3aaece245bd69fcad7508666e9c74a49dc9056d5fc14338ef38118dc4afae5fe2c585caffffffff309e1913634ecb50f3c4f83e96e70b2df071b497b8973a3e75429df397b5af83000000004948304502202bdb79c596a9ffc24e96f4386199aba386e9bc7b6071516e2b51dda942b3a1ed022100c53a857e76b724fc14d45311eac5019650d415c3abb5428f3aae16d8e69bec2301ffffffff2089e33491695080c9edc18a428f7d834db5b6d372df13ce2b1b0e0cbcb1e6c10000000049483045022100d4ce67c5896ee251c810ac1ff9ceccd328b497c8f553ab6e08431e7d40bad6b5022033119c0c2b7d792d31f1187779c7bd95aefd93d90a715586d73801d9b47471c601ffffffff0100714460030000001976a914c7b55141d097ea5df7a0ed330cf794376e53ec8d88ac0000000001000000045bf0e214aa4069a3e792ecee1e1bf0c1d397cde8dd08138f4b72a00681743447000000008b48304502200c45de8c4f3e2c1821f2fc878cba97b1e6f8807d94930713aa1c86a67b9bf1e40221008581abfef2e30f957815fc89978423746b2086375ca8ecf359c85c2a5b7c88ad01410462bb73f76ca0994fcb8b4271e6fb7561f5c0f9ca0cf6485261c4a0dc894f4ab844c6cdfb97cd0b60ffb5018ffd6238f4d87270efb1d3ae37079b794a92d7ec95ffffffffd669f7d7958d40fc59d2253d88e0f248e29b599c80bbcec344a83dda5f9aa72c000000008a473044022078124c8beeaa825f9e0b30bff96e564dd859432f2d0cb3b72d3d5d93d38d7e930220691d233b6c0f995be5acb03d70a7f7a65b6bc9bdd426260f38a1346669507a3601410462bb73f76ca0994fcb8b4271e6fb7561f5c0f9ca0cf6485261c4a0dc894f4ab844c6cdfb97cd0b60ffb5018ffd6238f4d87270efb1d3ae37079b794a92d7ec95fffffffff878af0d93f5229a68166cf051fd372bb7a537232946e0a46f53636b4dafdaa4000000008c493046022100c717d1714551663f69c3c5759bdbb3a0fcd3fab023abc0e522fe6440de35d8290221008d9cbe25bffc44af2b18e81c58eb37293fd7fe1c2e7b46fc37ee8c96c50ab1e201410462bb73f76ca0994fcb8b4271e6fb7561f5c0f9ca0cf6485261c4a0dc894f4ab844c6cdfb97cd0b60ffb5018ffd6238f4d87270efb1d3ae37079b794a92d7ec95ffffffff27f2b668859cd7f2f894aa0fd2d9e60963bcd07c88973f425f999b8cbfd7a1e2000000008c493046022100e00847147cbf517bcc2f502f3ddc6d284358d102ed20d47a8aa788a62f0db780022100d17b2d6fa84dcaf1c95d88d7e7c30385aecf415588d749afd3ec81f6022cecd701410462bb73f76ca0994fcb8b4271e6fb7561f5c0f9ca0cf6485261c4a0dc894f4ab844c6cdfb97cd0b60ffb5018ffd6238f4d87270efb1d3ae37079b794a92d7ec95ffffffff0100c817a8040000001976a914b6efd80d99179f4f4ff6f4dd0a007d018c385d2188ac000000000100000001834537b2f1ce8ef9373a258e10545ce5a50b758df616cd4356e0032554ebd3c4000000008b483045022100e68f422dd7c34fdce11eeb4509ddae38201773dd62f284e8aa9d96f85099d0b002202243bd399ff96b649a0fad05fa759d6a882f0af8c90cf7632c2840c29070aec20141045e58067e815c2f464c6a2a15f987758374203895710c2d452442e28496ff38ba8f5fd901dc20e29e88477167fe4fc299bf818fd0d9e1632d467b2a3d9503b1aaffffffff0280d7e636030000001976a914f34c3e10eb387efe872acb614c89e78bfca7815d88ac404b4c00000000001976a914a84e272933aaf87e1715d7786c51dfaeb5b65a6f88ac00000000010000000143ac81c8e6f6ef307dfe17f3d906d999e23e0189fda838c5510d850927e03ae7000000008c4930460221009c87c344760a64cb8ae6685a3eec2c1ac1bed5b88c87de51acd0e124f266c16602210082d07c037359c3a257b5c63ebd90f5a5edf97b2ac1c434b08ca998839f346dd40141040ba7e521fa7946d12edbb1d1e95a15c34bd4398195e86433c92b431cd315f455fe30032ede69cad9d1e1ed6c3c4ec0dbfced53438c625462afb792dcb098544bffffffff0240420f00000000001976a9144676d1b820d63ec272f1900d59d43bc6463d96f888ac40420f00000000001976a914648d04341d00d7968b3405c034adc38d4d8fb9bd88ac00000000010000000248cc917501ea5c55f4a8d2009c0567c40cfe037c2e71af017d0a452ff705e3f1000000008b483045022100bf5fdc86dc5f08a5d5c8e43a8c9d5b1ed8c65562e280007b52b133021acd9acc02205e325d613e555f772802bf413d36ba807892ed1a690a77811d3033b3de226e0a01410429fa713b124484cb2bd7b5557b2c0b9df7b2b1fee61825eadc5ae6c37a9920d38bfccdc7dc3cb0c47d7b173dbc9db8d37db0a33ae487982c59c6f8606e9d1791ffffffff41ed70551dd7e841883ab8f0b16bf04176b7d1480e4f0af9f3d4c3595768d068000000008b4830450221008513ad65187b903aed1102d1d0c47688127658c51106753fed0151ce9c16b80902201432b9ebcb87bd04ceb2de66035fbbaf4bf8b00d1cfe41f1a1f7338f9ad79d210141049d4cf80125bf50be1709f718c07ad15d0fc612b7da1f5570dddc35f2a352f0f27c978b06820edca9ef982c35fda2d255afba340068c5035552368bc7200c1488ffffffff0100093d00000000001976a9148edb68822f1ad580b043c7b3df2e400f8699eb4888ac00000000")
    // the generation pubkey
    val pubKey = BitcoinSUtil.decodeHex("04eaafc2314def4ca98ac970241bcab022b9c1e1f4ea423a20f134c876f2c01ec0f0dd5b2e86e7168cefe0d81113c3807420ce13ad1357231a2252247d97a46a91")
    // ...and the output address of the 4th transaction
    val output = BitcoinSUtil.decodeHex("b6efd80d99179f4f4ff6f4dd0a007d018c385d21")
    val filter = BloomFilter(10,0.000001, UInt32.zero, BloomUpdateP2PKOnly).insert(pubKey).insert(output)

    val (merkleBlock,loadedFilter) = MerkleBlock(block,filter)

    //this outpoint is matched because the scriptPubKey contstants match the filter
    val outPoint = TransactionOutPoint(DoubleSha256Digest(BitcoinSUtil.flipEndianness(
      "147caa76786596590baa4e98f5d9f48b86c7765e489f7a6ff3360fe5c674360b")), UInt32.zero)
    loadedFilter.contains(outPoint) must be (true)
    //this one does not match since the 4th transaction's output is not pay-to-pubkey
    val outPoint2 = TransactionOutPoint(DoubleSha256Digest(BitcoinSUtil.flipEndianness(
      "02981fa052f0481dbc5868f4fc2166035a10f27a03cfd2de67326471df5bc041")), UInt32.zero)
    loadedFilter.contains(outPoint2) must be (false)
  }

  it must "update none of the constants in the bloom filter when the BloomUpdateNone flag is set" in {
    //mimics this test case inside of core
    //https://github.com/bitcoin/bitcoin/blob/master/src/test/bloom_tests.cpp#L446
    val block = Block("0100000082bb869cf3a793432a66e826e05a6fc37469f8efb7421dc880670100000000007f16c5962e8bd963659c793ce370d95f093bc7e367117b3c30c1f8fdd0d9728776381b4d4c86041b554b85290701000000010000000000000000000000000000000000000000000000000000000000000000ffffffff07044c86041b0136ffffffff0100f2052a01000000434104eaafc2314def4ca98ac970241bcab022b9c1e1f4ea423a20f134c876f2c01ec0f0dd5b2e86e7168cefe0d81113c3807420ce13ad1357231a2252247d97a46a91ac000000000100000001bcad20a6a29827d1424f08989255120bf7f3e9e3cdaaa6bb31b0737fe048724300000000494830450220356e834b046cadc0f8ebb5a8a017b02de59c86305403dad52cd77b55af062ea10221009253cd6c119d4729b77c978e1e2aa19f5ea6e0e52b3f16e32fa608cd5bab753901ffffffff02008d380c010000001976a9142b4b8072ecbba129b6453c63e129e643207249ca88ac0065cd1d000000001976a9141b8dd13b994bcfc787b32aeadf58ccb3615cbd5488ac000000000100000003fdacf9b3eb077412e7a968d2e4f11b9a9dee312d666187ed77ee7d26af16cb0b000000008c493046022100ea1608e70911ca0de5af51ba57ad23b9a51db8d28f82c53563c56a05c20f5a87022100a8bdc8b4a8acc8634c6b420410150775eb7f2474f5615f7fccd65af30f310fbf01410465fdf49e29b06b9a1582287b6279014f834edc317695d125ef623c1cc3aaece245bd69fcad7508666e9c74a49dc9056d5fc14338ef38118dc4afae5fe2c585caffffffff309e1913634ecb50f3c4f83e96e70b2df071b497b8973a3e75429df397b5af83000000004948304502202bdb79c596a9ffc24e96f4386199aba386e9bc7b6071516e2b51dda942b3a1ed022100c53a857e76b724fc14d45311eac5019650d415c3abb5428f3aae16d8e69bec2301ffffffff2089e33491695080c9edc18a428f7d834db5b6d372df13ce2b1b0e0cbcb1e6c10000000049483045022100d4ce67c5896ee251c810ac1ff9ceccd328b497c8f553ab6e08431e7d40bad6b5022033119c0c2b7d792d31f1187779c7bd95aefd93d90a715586d73801d9b47471c601ffffffff0100714460030000001976a914c7b55141d097ea5df7a0ed330cf794376e53ec8d88ac0000000001000000045bf0e214aa4069a3e792ecee1e1bf0c1d397cde8dd08138f4b72a00681743447000000008b48304502200c45de8c4f3e2c1821f2fc878cba97b1e6f8807d94930713aa1c86a67b9bf1e40221008581abfef2e30f957815fc89978423746b2086375ca8ecf359c85c2a5b7c88ad01410462bb73f76ca0994fcb8b4271e6fb7561f5c0f9ca0cf6485261c4a0dc894f4ab844c6cdfb97cd0b60ffb5018ffd6238f4d87270efb1d3ae37079b794a92d7ec95ffffffffd669f7d7958d40fc59d2253d88e0f248e29b599c80bbcec344a83dda5f9aa72c000000008a473044022078124c8beeaa825f9e0b30bff96e564dd859432f2d0cb3b72d3d5d93d38d7e930220691d233b6c0f995be5acb03d70a7f7a65b6bc9bdd426260f38a1346669507a3601410462bb73f76ca0994fcb8b4271e6fb7561f5c0f9ca0cf6485261c4a0dc894f4ab844c6cdfb97cd0b60ffb5018ffd6238f4d87270efb1d3ae37079b794a92d7ec95fffffffff878af0d93f5229a68166cf051fd372bb7a537232946e0a46f53636b4dafdaa4000000008c493046022100c717d1714551663f69c3c5759bdbb3a0fcd3fab023abc0e522fe6440de35d8290221008d9cbe25bffc44af2b18e81c58eb37293fd7fe1c2e7b46fc37ee8c96c50ab1e201410462bb73f76ca0994fcb8b4271e6fb7561f5c0f9ca0cf6485261c4a0dc894f4ab844c6cdfb97cd0b60ffb5018ffd6238f4d87270efb1d3ae37079b794a92d7ec95ffffffff27f2b668859cd7f2f894aa0fd2d9e60963bcd07c88973f425f999b8cbfd7a1e2000000008c493046022100e00847147cbf517bcc2f502f3ddc6d284358d102ed20d47a8aa788a62f0db780022100d17b2d6fa84dcaf1c95d88d7e7c30385aecf415588d749afd3ec81f6022cecd701410462bb73f76ca0994fcb8b4271e6fb7561f5c0f9ca0cf6485261c4a0dc894f4ab844c6cdfb97cd0b60ffb5018ffd6238f4d87270efb1d3ae37079b794a92d7ec95ffffffff0100c817a8040000001976a914b6efd80d99179f4f4ff6f4dd0a007d018c385d2188ac000000000100000001834537b2f1ce8ef9373a258e10545ce5a50b758df616cd4356e0032554ebd3c4000000008b483045022100e68f422dd7c34fdce11eeb4509ddae38201773dd62f284e8aa9d96f85099d0b002202243bd399ff96b649a0fad05fa759d6a882f0af8c90cf7632c2840c29070aec20141045e58067e815c2f464c6a2a15f987758374203895710c2d452442e28496ff38ba8f5fd901dc20e29e88477167fe4fc299bf818fd0d9e1632d467b2a3d9503b1aaffffffff0280d7e636030000001976a914f34c3e10eb387efe872acb614c89e78bfca7815d88ac404b4c00000000001976a914a84e272933aaf87e1715d7786c51dfaeb5b65a6f88ac00000000010000000143ac81c8e6f6ef307dfe17f3d906d999e23e0189fda838c5510d850927e03ae7000000008c4930460221009c87c344760a64cb8ae6685a3eec2c1ac1bed5b88c87de51acd0e124f266c16602210082d07c037359c3a257b5c63ebd90f5a5edf97b2ac1c434b08ca998839f346dd40141040ba7e521fa7946d12edbb1d1e95a15c34bd4398195e86433c92b431cd315f455fe30032ede69cad9d1e1ed6c3c4ec0dbfced53438c625462afb792dcb098544bffffffff0240420f00000000001976a9144676d1b820d63ec272f1900d59d43bc6463d96f888ac40420f00000000001976a914648d04341d00d7968b3405c034adc38d4d8fb9bd88ac00000000010000000248cc917501ea5c55f4a8d2009c0567c40cfe037c2e71af017d0a452ff705e3f1000000008b483045022100bf5fdc86dc5f08a5d5c8e43a8c9d5b1ed8c65562e280007b52b133021acd9acc02205e325d613e555f772802bf413d36ba807892ed1a690a77811d3033b3de226e0a01410429fa713b124484cb2bd7b5557b2c0b9df7b2b1fee61825eadc5ae6c37a9920d38bfccdc7dc3cb0c47d7b173dbc9db8d37db0a33ae487982c59c6f8606e9d1791ffffffff41ed70551dd7e841883ab8f0b16bf04176b7d1480e4f0af9f3d4c3595768d068000000008b4830450221008513ad65187b903aed1102d1d0c47688127658c51106753fed0151ce9c16b80902201432b9ebcb87bd04ceb2de66035fbbaf4bf8b00d1cfe41f1a1f7338f9ad79d210141049d4cf80125bf50be1709f718c07ad15d0fc612b7da1f5570dddc35f2a352f0f27c978b06820edca9ef982c35fda2d255afba340068c5035552368bc7200c1488ffffffff0100093d00000000001976a9148edb68822f1ad580b043c7b3df2e400f8699eb4888ac00000000")

    val pubKey = BitcoinSUtil.decodeHex("04eaafc2314def4ca98ac970241bcab022b9c1e1f4ea423a20f134c876f2c01ec" +
      "0f0dd5b2e86e7168cefe0d81113c3807420ce13ad1357231a2252247d97a46a91")
    val output = BitcoinSUtil.decodeHex("b6efd80d99179f4f4ff6f4dd0a007d018c385d21")

    val filter = BloomFilter(10,0.000001, UInt32.zero, BloomUpdateNone).insert(pubKey).insert(output)

    val (merkleBlock,loadedFilter) = MerkleBlock(block,filter)

    //neither of these outpoints match because the BloomUpdateNone flag is set
    val outPoint = TransactionOutPoint(DoubleSha256Digest(BitcoinSUtil.flipEndianness(
      "147caa76786596590baa4e98f5d9f48b86c7765e489f7a6ff3360fe5c674360b")), UInt32.zero)
    loadedFilter.contains(outPoint) must be (false)
    val outPoint2 = TransactionOutPoint(DoubleSha256Digest(BitcoinSUtil.flipEndianness(
      "02981fa052f0481dbc5868f4fc2166035a10f27a03cfd2de67326471df5bc041")), UInt32.zero)
    loadedFilter.contains(outPoint2) must be (false)

  }


  it must "build a merkle block with zero matches, then extract zero matches from the partial merkle tree" in {
    val block = Block("0100000075616236cc2126035fadb38deb65b9102cc2c41c09cdf29fc051906800000000fe7d5e12ef0ff901f6050211249919b1c0653771832b3a80c66cea42847f0ae1d4d26e49ffff001d00f0a4410401000000010000000000000000000000000000000000000000000000000000000000000000ffffffff0804ffff001d029105ffffffff0100f2052a010000004341046d8709a041d34357697dfcb30a9d05900a6294078012bf3bb09c6f9b525f1d16d5503d7905db1ada9501446ea00728668fc5719aa80be2fdfc8a858a4dbdd4fbac00000000010000000255605dc6f5c3dc148b6da58442b0b2cd422be385eab2ebea4119ee9c268d28350000000049483045022100aa46504baa86df8a33b1192b1b9367b4d729dc41e389f2c04f3e5c7f0559aae702205e82253a54bf5c4f65b7428551554b2045167d6d206dfe6a2e198127d3f7df1501ffffffff55605dc6f5c3dc148b6da58442b0b2cd422be385eab2ebea4119ee9c268d2835010000004847304402202329484c35fa9d6bb32a55a70c0982f606ce0e3634b69006138683bcd12cbb6602200c28feb1e2555c3210f1dddb299738b4ff8bbe9667b68cb8764b5ac17b7adf0001ffffffff0200e1f505000000004341046a0765b5865641ce08dd39690aade26dfbf5511430ca428a3089261361cef170e3929a68aee3d8d4848b0c5111b0a37b82b86ad559fd2a745b44d8e8d9dfdc0cac00180d8f000000004341044a656f065871a353f216ca26cef8dde2f03e8c16202d2e8ad769f02032cb86a5eb5e56842e92e19141d60a01928f8dd2c875a390f67c1f6c94cfc617c0ea45afac0000000001000000025f9a06d3acdceb56be1bfeaa3e8a25e62d182fa24fefe899d1c17f1dad4c2028000000004847304402205d6058484157235b06028c30736c15613a28bdb768ee628094ca8b0030d4d6eb0220328789c9a2ec27ddaec0ad5ef58efded42e6ea17c2e1ce838f3d6913f5e95db601ffffffff5f9a06d3acdceb56be1bfeaa3e8a25e62d182fa24fefe899d1c17f1dad4c2028010000004a493046022100c45af050d3cea806cedd0ab22520c53ebe63b987b8954146cdca42487b84bdd6022100b9b027716a6b59e640da50a864d6dd8a0ef24c76ce62391fa3eabaf4d2886d2d01ffffffff0200e1f505000000004341046a0765b5865641ce08dd39690aade26dfbf5511430ca428a3089261361cef170e3929a68aee3d8d4848b0c5111b0a37b82b86ad559fd2a745b44d8e8d9dfdc0cac00180d8f000000004341046a0765b5865641ce08dd39690aade26dfbf5511430ca428a3089261361cef170e3929a68aee3d8d4848b0c5111b0a37b82b86ad559fd2a745b44d8e8d9dfdc0cac000000000100000002e2274e5fea1bf29d963914bd301aa63b64daaf8a3e88f119b5046ca5738a0f6b0000000048473044022016e7a727a061ea2254a6c358376aaa617ac537eb836c77d646ebda4c748aac8b0220192ce28bf9f2c06a6467e6531e27648d2b3e2e2bae85159c9242939840295ba501ffffffffe2274e5fea1bf29d963914bd301aa63b64daaf8a3e88f119b5046ca5738a0f6b010000004a493046022100b7a1a755588d4190118936e15cd217d133b0e4a53c3c15924010d5648d8925c9022100aaef031874db2114f2d869ac2de4ae53908fbfea5b2b1862e181626bb9005c9f01ffffffff0200e1f505000000004341044a656f065871a353f216ca26cef8dde2f03e8c16202d2e8ad769f02032cb86a5eb5e56842e92e19141d60a01928f8dd2c875a390f67c1f6c94cfc617c0ea45afac00180d8f000000004341046a0765b5865641ce08dd39690aade26dfbf5511430ca428a3089261361cef170e3929a68aee3d8d4848b0c5111b0a37b82b86ad559fd2a745b44d8e8d9dfdc0cac00000000")
    //note that there was nothing inserted into this filter
    val filter = BloomFilter(10, 0.000001, UInt32.zero, BloomUpdateNone)

    val (merkleBlock,_) = MerkleBlock(block,filter)

    merkleBlock.partialMerkleTree.extractMatches.isEmpty must be (true)
  }



  it must "create equivalent merkle blocks if it created from a bloom filter or a sequence of txids" in {
    val block = Block("3262b4625df6e0e2761359d30a8275058e299fcc0381534545f55cf43e41983f5d4c9456c7a266cac8e35450e0423b93743b6c84d7ceed95b888df512161c58c267042f824e234e53d85c450f52ee0ad04277aa2b104712aaa3359831e66c59bcef05d142a5fb39eca656fa8e5c56d7a84ef4523f8b36a8525e584473045022100fa3f875dc56ca67d750a98480dd62091ba5db306aa83938e221ce6893bc78f6f022041bcc644cab1a3fef3e20f30c45ebf02fbc559fa24183848d04f69613c13267e210282f8769261e6d41b92a2c0f5da838d945cf83443a500ffb6634890cc35b5af3c1976a91474afccd8daaf8002a3fe47fa38e32b18a3f3f96888ac864dd1e73dddd261dbbf721696f8a0806c8773a25791c09e2edcde3edb42d305c33ab17996bcafdafdae0100473045022100eec444dbf21c6b4666aff7988712cb453ab4b9e88339580a201e51c1f5948d5e02207609abbf8dbc5bd9e535e943ae4af288a04a289f3379f15101d3d9ae0d52585446304402203d53759c6495fdea3c35e3bb1aa54607ea33d8157412012cfa169c53fa725cc4022072762d6e12f29841a98f6621f0d41d8289fc59e01f5d2ff6b3e4c713555003b9463044022017bf9500d4365a291977ed2df6ed2ab05e5cf7362e9756b92c5fe813f6cee8f702201f130c151fdcae134954e453698b67ad84a610142584fece6d001fff6ac4eedd46304402202d273ec35117afcab9968a7ac663bc1d4548d6b5eb210307f2ac6f301d421f5802202a605ffb7d74199590f50d6fc16c57c2a97f3c27a5b68e59c014751d53a15f3e473045022100f23eb041b56f7d698814e081e4e0b8c0b80b9a073c912670c1f6528ceee1f06602202548608aaffe99a7431b0e294391cd494f490b3e0ee548eeea8db26d6ba344cd473045022100b1ef53e4924122c9dbab896207c735adcef072872551dff3b5c82f23a9f886b70220125f81b2b4cb0d5b7b5d39d4e54bb721d7984e35daa786937c5a978bf579778fc595c1506eb8b138422b7b030f333597d376cae48a2a162f8fcdb34d1367c17edac692475202893c84473045022100cf5692b94fdf9cf045627247d318ba8eb83bdaee2d86954026abf53987b64b3402206f7966290b24419dd47e630d7db7232e6ec7a4b298c9352ab4cfa20910adc3612102f0af5aa92439faf2abd642ab8303a49c227fc0e8f95deef0c04864784fce25961976a9142c24720ab39f3b158b5fd738b8f042f7fbe9648788ac0e54bb33e4688947c6b0ea2f32525f0848208590cbcd4cfa4b8e4f1ddad807ac0b12978952da44c8fd84020046304402200229543e423ee9a2f5158a3aa8f7780d16ecd45dd39d38104785be45744971a402205493995c294fbe777e757a49cd6b95a4822a2660b63fed65a4bf8ff08338e0ad463044022076cd3b02b9587a8adb4148ea950a537f20b91e0b7fe6c8bea5d2a10eda09e2370220502d0ab082222eb0115d1b55a423cc1ff873118c1a249c97e165239fd4ff2cd7473045022100f250569e6d29168dfcfb757bd71dcd9f1a72907f8d98903bb386252fd566d09202206702e8b001d424ffd0b6d924834b5f7af593f6c44a8dbd2e78e74fce07bf553746304402203cb61bc7732ae7d0f20db32c9887c1d3df8f9edb28ebbaeb5a8e879e1a17668e022000ce8c2b08fb319ce510fa86f5fcad674dfed27628c0c588ea3107760e5cfcbc473045022100ad09f0be69bf082be9507eb3e88a4bd00f2a57505cd379a31d38bafff0048133022070a224625a3035d974fa92d48aa492d1d6d71d9c5e6827b89fdcccfbccac9dd24730450221008609f7288c3e73ece5a63db8f10e52dddb549f6a6ea36bfb685466f17af91e0f022047d813a34138d871f3a2448c2e6a707b072b55d37f8628664dc5e8d6c9f87e6b4630440220098e44a7f30f423406ff10dc548a8b984cf4b51855cd3570c13b727508251383022032f253f9d34f3bd0a26ef457de5b4e7f9e0aa08efbe9644fe68ca682748b52514730450221008ab3a20a3b3314a904d02e336c8da91a0b8ae6996ac21a4dcb6a3d4cb3b757480220391bf3ce204a931ef33f64f9d50dbbdd272786e99832baa2a2454387e40e9a3146304402204f37424df7bb35aa2c60647453e9a12648c882163dc4af82f1ad6520b2daba3802207544a3efd891aff255f09e52e7805776758d63059bbdfa89def9aa54691d7b7919a460630a6a4477d3827237e6fd79015b2102a8b919462279783f36643d97d0f47289ddf1668a38351006193ef84b9c2d2d972103b5baca2b10f51b082e503bc0551d0e8aeddf7bedcdb0e41355224a4ce8d17d13210233685151ed8abafe6cb2886cd0570e1760173aa60f5f8428d68946f016e9d48b2103df9b579dde97467b32db940840130928350404bf62534e5420389bca85314fa321032c853e57d8f5071cc39bb06613646c393ee02aa8c19e04ffce61bcca6eb915e0210307305d027285bfb6e9e99ea934f2e382f5f21d9f4fe0881dee9024fc1ab6a8c82103ce8763ab2f397e1de5786bd630afa12a01c89724657fddc266dacc719bc82f962102f8b0a65653af2bf736982081021b6873b490305a9debd46c56aa568d7f905de5210301876498e73cb0fe1961610224fd900c2d9e91aec60da5966d0ecf2168d6981b2103965d912ccb7bac36628b803e3418994e43ef6eb1f68a30e7310df77fb3f519b421033513389f53d369567a7f4ae233c2b8f4d844f90313cefd6c6aa84db4321d11c45bae1b8c364b6e2f8be9fd57015821025a6d95bf4413228e74001f5384f40f3b3fbc1118e1a7864e54468f9cbf2007632102eb9f559cea1d00faad07d9a1d6d00e3fe1ab8d831f3128aa7e5733435eb46e522102c91658ba2977200559acf512eacb12287c55e189d12d402e26d0ef46d50100712103cfe92e548f583f08c90ae789d6d7f715042457a11d520ec55c4c2b25bf298f612103b949061060d317746576c1a15bb4666b5db1ee577be9b4fffd0ace3dfbff0aad2103b1bfe0d7b36744666eefbac4219ff8971e74d99c23b438566f04de6cbc8e1d9721020de7fc20e62610d39b74e695800590a0dd31f8867341dbb89b71e80ae90e660e2103f8886c1481c19819a6893e0ec7e744f0b11c07af791f980c7ef9118965450653210287dc2f87e960a2f74c5341d13ebd03bf083201d5143c9c6b47fa17c043a6eb322103317ae2c088ab99c377d8452416ef437def9faef950de5242f974461752919e785aaea9c486b9e1fff2ecfddf015e2102b1c3b280aabb6a0dc6d2316b468de14be4a1172b6886f248fbaf614990fb85252103e57dfbb3a3098efd15269c869386925ac173cd924a97a33d11384eb6553279b121039297348016892ad6f389b98d8d3e947c677e627a98493a22268ca29a6588c39d2102ad13539a531671f108a03185156b49bdc93d89d40c5bcb9d3c6d9d81ab55d5712102d5eb07a7cac45ad3562855eca2f748d6dca4381ae0b167c0d7b273bdeeadcc502102a94c7e9ad50a8c8c36ee801e4f724bbcdcd826244a1a3413d1fb7461c27daff621039688270efc35a955c0bb6a8cda0cc00646e79f98631c93b6003bafa79036b4de2103eb9de4bd49ede0107d8f53616fe1286233bcf22d8f8097c6812b24479cc4fb062102d45bdbebc933d9945a95e170ad00c2e563eea9514ac17fdde5d806e7ec15a91a210218aa00f864e6d5b198fcb2056f10ce8d5f3d851a141758191682e739c8a90e9c21020ace0019a1b9f8ef090c2c6ddb35796f907b24e5c3705af45dd238475597e69d210292a97a52e1913073e089ed29c3e5254d665a07884a39ed557badbcb948c4e7a9210213459a210153d67b4af2ed02fe228e9951572a3b383325f2f047429e89514b49210384c4ca5b44b52e26ac21ea4c7b98e79ae57f75bd528fe756aa06e5dbc8d105485eae709e07efc011445f1976a914ad7ca68463c1b3e3280698d10c4dc6e899fa992988ac92c5476f3a9507fc232103c0c90e4386820c7823f696944cb09e2417bed2797bfa80c9e8eb0e2b1a859266ac8416a4a2c219d4f91976a9140f755179ba239f8367e282cf0fa264be3a137f8388acfcbac8e89aa85170008de2412982f2458a0078d45932adb7fa51fd3501592102b7ed45c6ae164de9d8366e725d2eddcc2103c298dcc9f56b983a7189867d368a21033488822f69644d2f0e4f84753872ea7312c0b0ef4bab5019c9821da1837fbd3e21020f391cabe366c3e84a3b0f87ad9ec00d440ccb56ce88b74a1fc547ce20a1f68321022f98a0076e100eeae175b879f39bf4fb04a90b80f7dc5173e619264324c1d9e52102702c0f2ac79c62703993e1a555201a2e6197feb274e6c029f283525dad99165b210310e26b0191b3656a02fe28f84ced3ce9754bc0023744c49d17351f0a8a65b5f92103fef91df37cd5712ee3321ff8d426eb8329ec9cf894ec84e3413a7caabd96c65121034b73420408275b709690abdacbb4e52d5748272d9a09a35967de637f33427ade21034522c6680e4caf1450fc78de6220c42918cac60c478e514aa43a0c009ab52f3e59ae950dda81c8d61834232103715774fa3d6b7097d7278398a48801468c209b2310b5e33b7418358bfaf8fe36ac420ce9cd0b1672df0a6f4b273a91b36b53de0c31fff4cd2418a86ebfb1398852fe72a15e6c3cba3336431bc1df48473045022100842cf1218c0670afc5ce734b5c09e71dd7c5a6e926797fc7feca60f764a1ed330220795dcb61f0ebd50bce4080f54396a3b95e6bb954301f370106728085092d6e5460a5016987676d67d10fdde46e17a8b322d87de498cf2036840f822b2cfb8260d10dd74adcdca2bb001f398a7fc3f5e1ccc8797ec354587e81a8d799bc693b2cce90ae0460488c9d989c6b4fc3b6b109aa4746304402202ae7fe809db978c16436aabbcba866cd1cb57bed1e5e4bc673846f9fc4c8d69402202680cc0bcbc2db4eeb68e1f6ad97dc6ad4e29971e7f35a19d904adea923b996c667e25480000000000000000000000000000000000000000000000000000000000000000fffffffffd76040046304402201ad637b92394c2214c0b3e58e640bd30c5af9da5326374da54378846858edba70220014bb70fca2b610a691a97e9f317a42589e42e87ab50fc606eaa5173d8fdefc9473045022100f11ecd9d25eafac37a349e2f360f2e60c37531c5a81e477d3dc2b28d7ba81fa302202e2af213c51175d574595db73291e0eedf0c7cb52f12422d99e23428e4430ca6473045022100ff24451a87989940e582863fe837598fd4ab2832cdc797a98b6c7a42410bcb0f0220050b6b46bd0f1e5509365d697aa2f822384e9766eaa5099554a2d0e723416877463044022047c1b511c270a6464585500a7ed849405ec415e09e44c8964243c46aaa41f6f50220051a2f426d2aac9cd23a5891de2c59e3a0beb5d24c8b07ec887b80980429ae8e473045022100cff833b776c1bb01ef0a3f652b9463ed58556bd2f8a9fe8ab7fe885d35864f1802205204bed5da1cb014bc654dd5364dbb07a7773d8a91767f998b636d55d4a31f284630440220497eebd4f101899499f799709759826c58dfa9fe8be311d2d9ae828f0ab7ec2d02201c8e2233096133ba48946fe7339aa6f2d1808d8956fc833b5dc1ea3ee0848274463044022028254f4659c715a5c1e49266f6d98a04e4f65adcfe2ff75af3c6b80a9669f76b0220596f7f94c90c115e9f6b9e25c8415cccd5cb04cab02470671549b5593c6126794630440220343eebbdb960ff1c06e1d254dd0f6bf4904d5713ea54cdc818a86d33ae9faa530220138e2bc37569e590d90cc24793e3b8218f2220c15be33be5cafb8727ccaa88424630440220762aac3f639e796fa2b42341850b9255f5499cfb0ba84e61f26f137262399b5002200c994617ef82a7f33700eccd1870bd391729bb05298e8a1ab58c21259f93280b473045022100fdd74fb4ad8093c202c97fafc37e6a9859b010e337ecff804fdcd81fdc3434bd02203039317dd55ec657505a2e6ed216fa00d53403cbaa20d27214f03821b6b17ae2463044022026d4ec27f83981073cbd1af448afb31769de40a60b64e93bff395838f52fc81502201b5d0ea59f6122df641f21abf3766bc37c487af49a16f8fc2f2a1f540768e26046304402200cbe2871b0aa440073965a413d084734ef8072fe36e26757605cf834ac743789022078b7a019e0fc349c0f4c4f491a5aecf637381b24045b4740142e0f435e89daaa46304402210098d2844d368d274eeb1011ff3d0cd1a3ee708d41ec7e71876a101251f68cc1b6021f3bc0bbf056d601ad4021b82f184bbea010a6f567d6bd793300f02498ecdf8e4730450221009cab565e927f774bbfe8a3555b4a6d867d69812c1788f848f27cff97acfa640f02204902037e8f9d043d2f244da86c418706057a3ba119db5c3fbc8f8d6bf9b1705c46304402200f62a03d3cde68fce4962b4335075d6b32f35218a92237ced6c9fa0b66b2fe1e0220196ed3ff219f62dbb22dd10b3ad91c5196f634446b81267370b908a912e6c17f4630440220639e6c511c7d38a9a6366de655c00603ca5a130fc14fdff14d2d1a7432abb885022044a26760f2a07f4bf1a309e721191292f542f9d9546d911a157fef0027bccd35ffffffff9c2403ae59c02e9110817ed29c5f4cf91d57ec1d3414d122f460c21f2adb9297bf55f3ea0025057e6088f78c1046639b63b4ed955562e77f7f629cbaf4b1d4be2e2ced0b018d1e975a8bc5c9af0041c11829795d9d02bdaf081a379b384b49a9c1a893dac768a53f603f4743833baefe7cb88edd787dfd79040046304402206fc6242d402599354978ecb37941fdb4b14a8a9b2c3c9f782730e71e1cea53260220635dbadc58f8b023d5b80905bf76e9cacb9a3e3a895921c7dc22c6e2aa3a69dc4630440220325b128c5820546683fa4171b8f4415b7637106ab131f8b703e8fe59ef32245302203719a06c3ec4527e761f07ff689f776225ffeb84bd1992723275a8e08d6b459b473045022100d21b7d7df64809782fcad9e9b76f77a8f548aaf82dc6d3b9fc54991e3df85322022062f38e37ac33ba7ecc0253744a4a0ff2af9d52062b9fa721a7e13c7a7cc5f69b473045022100ecc5fe7c94253fce3acf55203333576c7bcbb2035429743fcef95ef47f24291c02207b61b895bf2cdba31f277d0dfc5abc6554a6b3dee2e7de79ae0eff1668f0c43546304402206a4c04a06b2ba0fa4d72da30d0d73f87331ce4329499819498b981604cd43fe10220561fd67cd3dbcff2b775f552ef42de8a33065f930870fe55f336d6f428c189d946304402205f2af81c4fa965b8240f2d002f181780c5c8c38f77a943676fc2233dae0bdb2102204ab3da81e6a530995ab7599b754a92458c9fff3cc839f7665bfb5831e035a5a7473045022100c526c14acf0e99d0f1c23c4b88611690005e368e462b2b89fe36e9abd735bbcf022009199362249693a9d2d8bc1a60620eb3bded8204af001ca32c1e583d23e131ca473045022100afa7986936b8c75c55cd82936af06e4d6a02ec6293af889c75e1a6ca3c404c4002205da582888215825f04f03a88050f04290460edd9e4443882cf4af152209aaa2a473045022100c395bf025a3bd5d185485e80153d4a71c90baea44db5bb8fc6a5f6f32d8f08b102202d7cda0394082da379aaab471185c83fe8c4dfd1ef846632a0ab9c3d27723f8c463044022003ae2a17e20d90bfe258ec025622d3197b08647f4633e3cfd54b66379dedf76d0220553450ca976ebc057c6ecb788bc5eb8e010098ada6c4ffe583dbee37ca99975a46304402205795d2c37ea3b7b5b9b92e5c0e418995a6fe75717072842ba25f3656bad4c7f802204d9f6a023a182345345c8ae26ff1e1e11263a815cc9ea58e73601c61c230dfc7473045022100ad73e4ccd1a8ff563bfd7634618e4d68888a586aca6a128159371f78b69673d20220426737e88fe253ea9a85d2fbb12fe3ad9d082490e4a36ea542349c2238761af147304502210095411a30a1fbd6ef0b10ab4687f76fbbfc0f6001697504843a5124edf057f92f02203e1d45eaa45b56ee23bf7d83ab81685975b4490c0d49e738c96baeff148a2e6246304402205abc0ac643fa364f7f255db235804157d124205af82e2fa473d8bb4a7905443a02200d89fc0dda126eab8cd527efa6db5b6477bf82eb01c51e79e43a10d90c907f77473045022100f63be62ca0b94516daa56a183a08c880b37519a94ff21f8b626ec24aa921009302201cd4f1f51a500a07302ebe2feceac9173f923877d1141beae3bc4bf73d375ca94630440220417157dd09ea28643e22fb6b5163a84bc2e6bd43d155c528726600d241694fca0220299a89d6c3ec259e44b973400f6db255f18a52e42a6c62d9359fba0d2184a9cb54fb9e99311f221faba429b29f400f2fdb3c1833b3514baf686c3f1427544ad01c7f276c2414f20a8346304402200128b2bd914502e18cc63e6765573b8105302e76b07e7374ce48c4f0356974e0022053f7324e6eb3bb17f7a6c9441956f87ce0e391bcc7c3fa3fbb39723b80d941ea21024e50dee9358f0df3f21b80f29e0d1bde93f606da2715adfc1af46d8aedde443b1976a914e98e951bdc4590b669d22229ec4ce022d4ab3d8088acdfb81de16a2f64140877ae666028d1d3e6af44c1f0d069b2a47621f9a92ffa285c1d153da1bdfe0afd750400473045022100c74d067d87097f5b9cca436f522ba06b01b6f0e4193a9769df5f7358d78b3156022045de7c6f8f698567c6d6d91e3aca468bb14e2db320d7a7f182efcc4bd4876154463044022048b42559b5072f8bb35fa8000c863d685d5a8c7a5e0396d482930a816540530902201ed5d6a0b01aa6a1cdd27ec247f97c850ec9b0547eadf052d4de16055bec151d46304402203cd4b099a12c13b38e8fc80843c13571180170cfd1eac8812e7ccbd5d2c76a35022015f88503c2dd1f7e433a064db7b4fba81d0bf43ee592c669b43ba3b82eb7d0234630440220215c758518fcb78449522404ad529b688aab3d8e7c7ade095bf9c5cbf96d290c02202d0f02fcd89687bea70e2e7ca49b7d780a0785560a3198ed7df6c933f444520b4630440220360e163ab8412823a5253b1c08536f2838dac8b2a80fe3cc2e2b3e1f5df2aba402203639d70befaa16a4032f7b23e683fab9a22dff834f69a75e701880d9bb59c98b463044022015bab54156dc146bf5a1e0663034730319b446196486f92fc81477ecd303f72a022010d637cc7678a534dbc95fdeaf0641afdb68e82c5113f88e462a3604a8434050473045022100ae91d38077c2859d9c3cee7bb15689b48358b39c4cf0eff3624a15a93161a8390220441c02b87634818c5378e8d515c1a06a7bd6f97a616d71e82995f7267ce4b0a546304402206a6f43abdd26c615693220f3576010bfc85c667f83c7921846fe369883d99e910220570137eedc2344cd65e76551bb872feb6e4adeb218594e8d54f02cc93307613d463044022044e7176554d1f760e40852e5d1cbeac7bfdb9a805e2d8c013b385b02e4a4813b02205bc1b86e0a8604c63a096e5f87b7c04c7af0586a56d251eff676a531a4033fb84630440220063bf6ff87a5508a57e2d2c20dad19e270b1ab7264aa517738e21d3c5dc1964002201d24f476cbef0adbd89c74d1ddf7e72980a171e2b32c32ea66dedb01e49b4ff7463044022029741e5fefb4fab7bb7fbe3084f4d6887aa72d7a40ccb613652678ff880abaaa022026eb6a412d6d946da6724c78b951959616e50343ab92f2d1c722bf54b7278f65473045022100ed5b418a85e154525ad9d0dc8d27b98c00ce215ea13960f696322fa863e9833002205302c11b9116006ce59353659ab24c5cf7e666128c97d714455b17f1cb89bf114630440220316925877b29c00c876e35cc99d76eea2e0b3dfc8bd06abdccc3bdcbd6fd0e24022043ed0bd6681e1a4ba7d187c45b1a59383e137242baaafaff8ab601c38747d1d647304502210087b711b70e09f6ef6004461d9c688909d179a4be3a9574d63e1991afa7e22c3e022021e7ca60dcb515e677bd88319289a001abe26b07415ba7dfa00e70f95be8c6cb46304402201c8eff9a5051a60649ce671d6d31c54c9759c806e157e459962551884e7ea4af02203931cbf9f333f3443701c647afe58d3c06cbb26b141db7477e79c96e4d4d34a346304402201068eaf8e6f39c0a4625ba9349222bff0df0758bcf6313b37468cedeb94de7fd02206fe06ac2de1071e46439f558a35ebf6bf8875f1a518f5ce02dc6fc3e5f611a27665f47e94672c8145cb3e2213531615df2c0aa0c686e19798d215d8597bf59bcc5c9e794a0d6048afd0d0300473045022100810e6dd7464311e36fd702e892cd12581456651281829990fa9b692ed6f175a2022043e793b1da6d5820a3ebea0a22d0f07eaed3c0900314595f34df3e850bbb628c463044022059951b253a3ef907fb29d730442f8575396f041134c9ebcc0904feca33c640ed02207402c95e35eb2c1e2d9e6d6bd4accdf6620be3695bdf3d8212cb2c8bd1f7bc7246304402204e85f8b5a378073eba40f7ff3bb3734cc2a046ea7f060bc76baf65b0e3537faf0220607b544ce22b012d88161ab8083721d6b432badeed1aa93003787d5c76b69d4b473045022100c0abae23c4ba81796792accbaa00197aa97f14d52550a2b82f3fffe30cbd134c02200798af13740a9e3c2ea4137e272cea437398c9175b4d793cb45302ba6743ca0e47304502210091ac09a00ba09ed52c8f18169a84c88ae1e029f7c20bc47c222ebd59dd016f8e02200123051d8191675b1e63c48d223ddc0d38e1fea08358b576423b721c4dc27862463044022043875a601c2e98bc00d121f9dd7618050ac94e766bf8d3a927260221abbbcc6a02204e06c2bf529a9a1b75b160bd55fd73f345d9d40ee3d4f15f984cbb01d267fa19463044022040df323c538e4c9e10cb826507cd3f83aabb0983be818313a66392e82e801a5302200a718775ac7957a9350442df421b3f6059bd6c0a32f7776bdfc6edb1da98993b463044022040f84d8d0305b8164f0a91b7b9d6f2642714bce5fda5faee5ca4ea52720f7de9022054ef4dcedfed2882de7bfdcc2613da52d6aedaec29b84aabe135d663d90b62d84ccf542102db9d09b60d6fcf50d3290e3078173af5b6cdb2454746770d6c86b3677270c6732102089b8ac6727336a8343f140b65d76c8710364b89fae5669dcd8c6aac91904e142102ac196a356bb731f225d7d0005f32b864fb3b35836a3e28460af1a622f1c383f72102efc7bef0150752d1da515c7341b645f59292cdaccc4b7a17e87edf654ac5a4d72103ff059a385cc46d299a24bc5c7737a0c9b083247919062c317bc09d77974faec72102655ff6ff38151e48e7d40ed57bed7b6573e00044c4e159bc25f5c2ac6eab31dd56ae171fbd8c07f06ded9974d5f5c7232102312239452b357f9baa50043c7256211476f9f232e18df78a6b4abadae902a5dbac88dc9ef6847a8f73fd9b01582102aa962262b31bfb5274e57ab580d86fcc0e7cf354d1d6b42cbc9f41a8b79d69ba2103713031e5678adba942aebb965a0888d287390ad48ed0397bc0f8cf60160cd4342102c22bb3c125d0d421b842c41a8c8771def88e2cf26bba157e98b7bf18e74520b82103f0122c7d62fd18a596723a2c0887f680486ca1c1953560fb9a2c6c24a1ee8cf72103a02b0b5714a30150e5ae2024d2756cace2f10f9b33d26b80885ebc30933d090921021ee25cb3f0d378b0afee856d81bbcbca63cfea35bc983b38f8e7648410aecfac210379c09f5bff3d2b7fd6217b4f0dd3772eac005ea4b95a2bbe6c321486628b72ea2102aa4aefb79b03e19dcc6a1841b22bb5c226bf9f4c28902d4bcf4a348135912a7c2102af4252f121827a5d6b5d0f8273521a25cce2e7974519e09076cb796d2d3963052102a73c8370d07ac353040bac2f5e7ee27801190192c8a3e0dac5d0a2b19a72138b210225b5ec15c1a7361ce5a1cd91ce0b302db4c5a50b38e892612054c145717c263f2102fcc0ef0d7b132d3676b8249e4419d98e51dfe63581e6cdbfb751e8fbe7d2e32b5cae6e1b9954fc0fdb2500dcf34b9a5d23f7e70069bee40d9059b48500657a120783c184161976a9147e73483c1f4136c86417440e8d72f4e1fc58d1ea88ac6bedb17b05ed790800558d11f3f42f4acb01c875118efaebb41a2f98d618ec1106e05da749ff89685db0b7d5f8b72341d20df36e04e248473045022100f6dd02d1279300343dcd8db112457f03c15c89c11daa4193428ac2a80cc51d1d022037c66ebf834afdd2cf93e15825a20b64707d7cca329bd8fe10f7a8a207b23810e137ccc003894e32f597b20a381976a914d79d883b0301f03e486a74fa01f336fd0d1faef788ac59609e26c208c8b81976a9141d321f045a5c01d5f55b68fdb12ac95330cee8ae88ac600dbecc141508d2fddf015a2102d6f03e10197ab2369668a655814412f6f5e4303c9d0fbc3bea1407c221f900c6210376ef46775288543df061dd2a2f803e9d85989e6d2dc2429580c05c459c868e842103ca600d30d649b5a750fa3a3dfe3a09f80787b6e9744eba58b87e53103e5ba09821031cefc7bb608359a0ef7422e051c7e19cea0a78e97e15c43dd13ddaf8742298b9210267c31b11df0cdd357200d1cb38c4ab39817de7da3d51b83e844f7e4cf893acdf2103c2f607a37cfea2fe5bf5710d86de41650a8b0eb8f75384b1b2c9609c0f8a06582103b82e19cdfe141147ba7f66e66f720ded742e918dba294c4d198be46db83dcbef2102df6877eb91b595f31e5af9f344a565a0a85cf35ac9c2c752893d3375471ebd9121027d8fb6d39be0d5129030a4af6170d7fd257bc6dd205e14fbfd63754aaed8855f210290218d5c8429cf03fc75f51aaa0f6fb37a22be7ff881655c8fe49a666349b6402102f86b90764a47df66c7942543c0c19ac415c8695189dd01914a427ecf870ee8bb2102431bd4bc4ae39da048b5b568b1aebb5d15809a5b892f78139a8add08cfb199932102591002d24cba0cd4cad2fd0adaa0e02713df5e8a7a6ca96b9795a6210ead17e6210276897ef141aa27ac1f97ba3d56a773f5a7db8c8fc5e29fbbaa8aa356898275015eae48105e8beb94f6ae0a87af253f805370636b637b7d2ef1d6957302107b100a42bb8c917faccf36bd87c70f0ede834630440220127371362c7136deb9e37aeec538d250d67917a22968388ff7790eebd0324632022002aaa8abc49f6b6dbcfda2d57ffebb55cfc05297379294711100a70b9279ea7a21024739035107202fdcb2792f64e50ef6dd9abfd9a25f7028a00f1300e0c54070b81976a914424ec434327e9f08eb8858f2ec81ec2caa10b32e88ac9f81580ce09e2f7de808acc88137777047f886a379cd0ae303c0d4cfbcf816e8c669e56f899962aa6b46304402204b5e43ac0637c47c8e99dec1fdd491e05b26112cca3c47d80bb04262af24527f0220336aa40ea836770e4f132e8f2219d49db0c2d671814f6c07dd1fc82494ab4b0a232102bd252e706d7105578d124c96b252c182fc9682ca94af11fb507878803f8bf7e8ace688407aa930a1f025eccf5aae0e7f640770de99d4f9aab8221b1f8d06fdb11a5d15a891ca0e8c2b48473045022100b396358637f5408a6ddf71a0a8ec64a133ee090db161898b35d14a1d20691513022062823453959072b3970fa2d8563932174bf5dea14d31aa300d2c5369780537a7c523cad80b9e72fb038694a6f4923ac38314a36b334ff0b715e2ae182a35f719640a97ab525700d7fd5a0400473045022100aea47d8bfc8f53b6d936599472382ae1bcfeafd34bac7399770e581bb7a326ad022002ef9626ec3a42d101624e77f2af34720d47cbdf73f38ec2006d93d7396f9a7b473045022100edafc6336a7b0e16124c3a7039211229e2eacb3f7ac57eeea2d5d750859b29c302206f8f8643f10cee515b43a80f6747910051d3a507e244a39513c7907306caa961463044022035ac15c56678d3efc89a36ee35d29813ee777f74c85be23d83e9739727b6334f02202acd3f036b9dd29cd530adc674250afbcdccb0bfbce5fbe9d1ae77472a6fad4e473045022100eb6d5b1f8fbbe70f99ed977eec50ded19301d501d9a3f4b4a06e6649455beb580220024d02fe5ceaa330c8bca15aaa3126e1c6590e4e714b421aa379dc2f1cbbfe2b46304402206a06d6179946eb1cddb36c456228deee4ee28ef8e9e7df5e05ef47350c73d8d202200de03f0f60ed4681f8439432917face05bc4887761a5737c5e2a8bbf97e265d6473045022100ca68aacca09a252ff295548a5ef0a8839658db1ab690f1b259e390f94e32855e02202b9fc600b03dbfb0b76dd625921f6e5bc39656467fa1d9687c0d3deb55aaa363473045022100ac7f77fbd54003c0be2abfe6454aa11d9ae6db998ee5564ca9bcae8775af00aa02206295fe0ed3f83839d2b54850d9bfbf9b938a955c33a23b71fdfda5d56f1b84d9473045022100e30e09b8889f1e281507d12ea7723a8a5a25ce5fe6ec73929e4a94506fa076bc022022ecb49151eba458dedf02c7f1bf0251240ac83c6ccf3df618a9509e6fd082f84730450221009ecdbc46eb636fb73ab81b14d439f22444a5193bdbbf38a807fca677c87de0ec02200d3e3f726a45909359cf4b585ebb86363981e68c8cce9b6deb8d669787a256d646304402206db58aaddbfba5552702f7c44308b1aea9dd494fda54848b35ff84c2c71c8a7002200379ab9584a6de6101a17a4eebdc57961e91a3dbc4ae90b9a73819b073f68f4a463044022030afd384a182a7a8641c37fd673bfe93a74819249e54dbbf6c02e93de0ab6c2f022075512e27ccac64fe2e74fc35c7e351c8db3831fab9866af1904906c4bc03ecf947304502210084cf143e0023124dc27762baa8028293a4f4f60c980e62e9a199abf572fb903a02200e3e60f4f7eef39bea41db931203581ee3ddedfc299721c8dbf2907a241fef46473045022100ca1fb3621ea238721fc6965f7efc3165c30e28fb990c3a5e76d0917eab7f22c202202135d4425f9216007818ec3e9dc05624d31c1bb2d56624f09702e682ae63b79b4630440220273a91a355ac5900f4348f18c60def28232461122831ed1161497403c972446f022044d59600632e5bbc0a5cc843f1a5d7913a75f6629085cc8b5b39f1ba81f5324c473045022100e341c40ea77d26a2da37fad74ae0927e78be3db2bec832317a0b0e4ff516e66d02200f2a39d6a9ae1f343a67c1d1c6f58466731c227dee067514049cef7418476a2125002102d64327814f691a42d3755e238919ed191f2788f7a6ce6c2dcb23139930b8c97951aefae0d75723e1503282b725d3ea2fb64bd7a8564f9b9097dca0040072c3f21221b2f208bcdece988400e113070726646c0f5bd618a638ea5ffdeed8af3e3fd9f1ed0e66f5fe7daad18600961545733cb6c248473045022100d047a5b6bb5f02ee9147fea5ad516e360aa875fd3b58f252051fd442d20b7056022050531b945683cb12e2cf99e2b74a11506905d290b377cf03cc16dc381941aa11ed4e43d41d5dc7a0042f8c5b0c0e217550498552b4d14024cb406c92f41dcedb4f07e6ab71f6ab5f6c473045022100e0500858f38ad3ec59c6271997d54a0f7679661d129c188495d08fc695e587c20220708bfc9ccb872105f6c5aa7d8586dfe9ec82145a61edf38d5ab47760869d644023210291373b7b1a1ae01203ba5ac465ab47ad2975dd46feb0c6827d38bec670d79d14ace63a901a81919b3da3bbdf48602f94df63d0ccfcc8203bb1412e88212b533350f813f9822de75420fd3b02004630440220792d4365a4b433737a83cf75f47073e5266ab28e21758fa5994f7adbe92373bd022061a9def9ce44be09c934469a771ddb0eec559f2e257da0e733f5c05cdc1af78c46304402203a5b0294c6820e652a157a9f241658c632563594e4aaf3937f5f1fd2b7e94df60220625d6dee041dcc48c15927db2a4981c7854dbad62feda43ac084948cb4c37a72473045022100f8c67a99c36a2a73a0edc5defc063a51e426d8fa08b49a709fd96e39700fc2ed02204b0aa14dd4c6000ce9554812afa6c02a5765c41c214f908201328885d25fc3f14630440220784b4d20f4c85bf4b1a68a2683d8cfb7d798909399783005e42c856bd7aebe12022071b66e455d812e13171b675dcd3bbff559a7db42b09fea12a8531f75217b474f46304402200899bb9940e1180c55fba8400fb011ac6e47f52faa54b1d818eda651f6ccb27d02202dedac2049ff98bc142f183b4129a0617f351d8e7224a8ab7a70d6e8fcd982bc473045022100a0e3d8d0848e75d89871199b6b1ecdb5ebbded25cd84b31426a3bcb911852f2b022014eb50f2c2615d825c35c29a05dcef06550b755a47a27f5bddf199312bf432f246304402200ddc04324f0a6bbd1a066477aa6d07af95f2f815cd45fa58c59858af6b525f16022034797d1d71c08dbeba4792cc0cbc9ac55d17fe114cfff1ccd3c4e2cb41610100463044022055331ce180b06b6f79c73c7a41fff0365ea2504aaaa9b9f142be7854f91d2eb002206db67280ff22164606c70a79905eb917247eaf9d5eb5cfec5343b9dd4f6aba8a2b345573014aad6f4ccf7805ae1aed6e5dfd2757458b4d3b4da52f344afbbe0ed076784cf55e17a2484730450221009bfef877e07c3ce100208dd7d522071b364df4270a5734742804e9ac2c2426740220298f95eac3d3e78e71c2cc4e6d8647acf6c53df205eab3e44aa807a7e4daf6a3cf98bc760000000000000000000000000000000000000000000000000000000000000000ffffffff00ffffffff036c30f9dc1d730fa017a91476326fdefe3eb33c3fd2888e7fa809bfdc53423a8761de5c33e996eaaf232103533dc3a1bc0452280cf1f581ef4653716c02d2c709e51d2107f7a96ad68edae0ac2f54e7b569135c7dfd3501002102486f9c0dd1895e81be684a01390943457416dab4f8ee7f13cb6e342c8b0d5f692102ddb8a7ead021bf99170557d9e91787b7d6da90d51a84de5215cf48b0ff16944221037876edc52e51fa062caa4e7954d4407bb5abb5525e720a401a0524a1f4e128672102494e028fe6cde1e42309a83d8fc1e9f7aa23c683647dba1c8902b04f8ab250c42102632bdad1832f3094a27011598434b6dfd3ad5c0e324343548955b9e47699ef202102c179afe6d0a8c7ad74977ba93a31d02b3339a4fa9eaf6f594418b748fda075dd21036d1d97c281eb12ff31d4a3d6967ab5ca70f7debea1541fd827e0b7afe8a93c2c21033f0fadba950ce670f916fd98329295be45de5e3e45f21df9568e9648462d84df21033de867cc52ae1833d035de009b0d2ae72415e51aa33572f751dacdfbc264800b59ae01c3d5a4")
    val txMatches = List((true,DoubleSha256Digest("635f69962abb6e75cc3a94b6c604ad86f33f514eef12a33fefb8ea15389b1fd9")),
      (true,DoubleSha256Digest("62e40ece65cff821b739f2cf310a9917c97e7475153df8a55fde1ea151731f7f")),
      (true,DoubleSha256Digest("889d7ede4ca91fddc32498ff1b7400526419863af3a84da2dcd24cf487fd881d")),
      (true,DoubleSha256Digest("dab811210e8000ac63166d032cc2347a149b2796e10b0292c249f61486e416a8")))
    val txIds = txMatches.map(_._2)

    val merkleBlock = MerkleBlock(block,txIds)
    merkleBlock.partialMerkleTree.extractMatches must be (txIds)
    val bloomFilter = BloomFilter(4,0.00001,UInt32.zero, BloomUpdateAll).insertHashes(txIds)
    val (merkleBlockFromBloomFilter,_) = MerkleBlock(block,bloomFilter)
    merkleBlockFromBloomFilter.partialMerkleTree.extractMatches must be (txIds)
    merkleBlockFromBloomFilter must be (merkleBlock)
  }

  it must "create the exact same partial merkle tree from the info stored in the merkle block" in {
    val block = Block("3262b4625df6e0e2761359d30a8275058e299fcc0381534545f55cf43e41983f5d4c9456c7a266cac8e35450e0423b93743b6c84d7ceed95b888df512161c58c267042f824e234e53d85c450f52ee0ad04277aa2b104712aaa3359831e66c59bcef05d142a5fb39eca656fa8e5c56d7a84ef4523f8b36a8525e584473045022100fa3f875dc56ca67d750a98480dd62091ba5db306aa83938e221ce6893bc78f6f022041bcc644cab1a3fef3e20f30c45ebf02fbc559fa24183848d04f69613c13267e210282f8769261e6d41b92a2c0f5da838d945cf83443a500ffb6634890cc35b5af3c1976a91474afccd8daaf8002a3fe47fa38e32b18a3f3f96888ac864dd1e73dddd261dbbf721696f8a0806c8773a25791c09e2edcde3edb42d305c33ab17996bcafdafdae0100473045022100eec444dbf21c6b4666aff7988712cb453ab4b9e88339580a201e51c1f5948d5e02207609abbf8dbc5bd9e535e943ae4af288a04a289f3379f15101d3d9ae0d52585446304402203d53759c6495fdea3c35e3bb1aa54607ea33d8157412012cfa169c53fa725cc4022072762d6e12f29841a98f6621f0d41d8289fc59e01f5d2ff6b3e4c713555003b9463044022017bf9500d4365a291977ed2df6ed2ab05e5cf7362e9756b92c5fe813f6cee8f702201f130c151fdcae134954e453698b67ad84a610142584fece6d001fff6ac4eedd46304402202d273ec35117afcab9968a7ac663bc1d4548d6b5eb210307f2ac6f301d421f5802202a605ffb7d74199590f50d6fc16c57c2a97f3c27a5b68e59c014751d53a15f3e473045022100f23eb041b56f7d698814e081e4e0b8c0b80b9a073c912670c1f6528ceee1f06602202548608aaffe99a7431b0e294391cd494f490b3e0ee548eeea8db26d6ba344cd473045022100b1ef53e4924122c9dbab896207c735adcef072872551dff3b5c82f23a9f886b70220125f81b2b4cb0d5b7b5d39d4e54bb721d7984e35daa786937c5a978bf579778fc595c1506eb8b138422b7b030f333597d376cae48a2a162f8fcdb34d1367c17edac692475202893c84473045022100cf5692b94fdf9cf045627247d318ba8eb83bdaee2d86954026abf53987b64b3402206f7966290b24419dd47e630d7db7232e6ec7a4b298c9352ab4cfa20910adc3612102f0af5aa92439faf2abd642ab8303a49c227fc0e8f95deef0c04864784fce25961976a9142c24720ab39f3b158b5fd738b8f042f7fbe9648788ac0e54bb33e4688947c6b0ea2f32525f0848208590cbcd4cfa4b8e4f1ddad807ac0b12978952da44c8fd84020046304402200229543e423ee9a2f5158a3aa8f7780d16ecd45dd39d38104785be45744971a402205493995c294fbe777e757a49cd6b95a4822a2660b63fed65a4bf8ff08338e0ad463044022076cd3b02b9587a8adb4148ea950a537f20b91e0b7fe6c8bea5d2a10eda09e2370220502d0ab082222eb0115d1b55a423cc1ff873118c1a249c97e165239fd4ff2cd7473045022100f250569e6d29168dfcfb757bd71dcd9f1a72907f8d98903bb386252fd566d09202206702e8b001d424ffd0b6d924834b5f7af593f6c44a8dbd2e78e74fce07bf553746304402203cb61bc7732ae7d0f20db32c9887c1d3df8f9edb28ebbaeb5a8e879e1a17668e022000ce8c2b08fb319ce510fa86f5fcad674dfed27628c0c588ea3107760e5cfcbc473045022100ad09f0be69bf082be9507eb3e88a4bd00f2a57505cd379a31d38bafff0048133022070a224625a3035d974fa92d48aa492d1d6d71d9c5e6827b89fdcccfbccac9dd24730450221008609f7288c3e73ece5a63db8f10e52dddb549f6a6ea36bfb685466f17af91e0f022047d813a34138d871f3a2448c2e6a707b072b55d37f8628664dc5e8d6c9f87e6b4630440220098e44a7f30f423406ff10dc548a8b984cf4b51855cd3570c13b727508251383022032f253f9d34f3bd0a26ef457de5b4e7f9e0aa08efbe9644fe68ca682748b52514730450221008ab3a20a3b3314a904d02e336c8da91a0b8ae6996ac21a4dcb6a3d4cb3b757480220391bf3ce204a931ef33f64f9d50dbbdd272786e99832baa2a2454387e40e9a3146304402204f37424df7bb35aa2c60647453e9a12648c882163dc4af82f1ad6520b2daba3802207544a3efd891aff255f09e52e7805776758d63059bbdfa89def9aa54691d7b7919a460630a6a4477d3827237e6fd79015b2102a8b919462279783f36643d97d0f47289ddf1668a38351006193ef84b9c2d2d972103b5baca2b10f51b082e503bc0551d0e8aeddf7bedcdb0e41355224a4ce8d17d13210233685151ed8abafe6cb2886cd0570e1760173aa60f5f8428d68946f016e9d48b2103df9b579dde97467b32db940840130928350404bf62534e5420389bca85314fa321032c853e57d8f5071cc39bb06613646c393ee02aa8c19e04ffce61bcca6eb915e0210307305d027285bfb6e9e99ea934f2e382f5f21d9f4fe0881dee9024fc1ab6a8c82103ce8763ab2f397e1de5786bd630afa12a01c89724657fddc266dacc719bc82f962102f8b0a65653af2bf736982081021b6873b490305a9debd46c56aa568d7f905de5210301876498e73cb0fe1961610224fd900c2d9e91aec60da5966d0ecf2168d6981b2103965d912ccb7bac36628b803e3418994e43ef6eb1f68a30e7310df77fb3f519b421033513389f53d369567a7f4ae233c2b8f4d844f90313cefd6c6aa84db4321d11c45bae1b8c364b6e2f8be9fd57015821025a6d95bf4413228e74001f5384f40f3b3fbc1118e1a7864e54468f9cbf2007632102eb9f559cea1d00faad07d9a1d6d00e3fe1ab8d831f3128aa7e5733435eb46e522102c91658ba2977200559acf512eacb12287c55e189d12d402e26d0ef46d50100712103cfe92e548f583f08c90ae789d6d7f715042457a11d520ec55c4c2b25bf298f612103b949061060d317746576c1a15bb4666b5db1ee577be9b4fffd0ace3dfbff0aad2103b1bfe0d7b36744666eefbac4219ff8971e74d99c23b438566f04de6cbc8e1d9721020de7fc20e62610d39b74e695800590a0dd31f8867341dbb89b71e80ae90e660e2103f8886c1481c19819a6893e0ec7e744f0b11c07af791f980c7ef9118965450653210287dc2f87e960a2f74c5341d13ebd03bf083201d5143c9c6b47fa17c043a6eb322103317ae2c088ab99c377d8452416ef437def9faef950de5242f974461752919e785aaea9c486b9e1fff2ecfddf015e2102b1c3b280aabb6a0dc6d2316b468de14be4a1172b6886f248fbaf614990fb85252103e57dfbb3a3098efd15269c869386925ac173cd924a97a33d11384eb6553279b121039297348016892ad6f389b98d8d3e947c677e627a98493a22268ca29a6588c39d2102ad13539a531671f108a03185156b49bdc93d89d40c5bcb9d3c6d9d81ab55d5712102d5eb07a7cac45ad3562855eca2f748d6dca4381ae0b167c0d7b273bdeeadcc502102a94c7e9ad50a8c8c36ee801e4f724bbcdcd826244a1a3413d1fb7461c27daff621039688270efc35a955c0bb6a8cda0cc00646e79f98631c93b6003bafa79036b4de2103eb9de4bd49ede0107d8f53616fe1286233bcf22d8f8097c6812b24479cc4fb062102d45bdbebc933d9945a95e170ad00c2e563eea9514ac17fdde5d806e7ec15a91a210218aa00f864e6d5b198fcb2056f10ce8d5f3d851a141758191682e739c8a90e9c21020ace0019a1b9f8ef090c2c6ddb35796f907b24e5c3705af45dd238475597e69d210292a97a52e1913073e089ed29c3e5254d665a07884a39ed557badbcb948c4e7a9210213459a210153d67b4af2ed02fe228e9951572a3b383325f2f047429e89514b49210384c4ca5b44b52e26ac21ea4c7b98e79ae57f75bd528fe756aa06e5dbc8d105485eae709e07efc011445f1976a914ad7ca68463c1b3e3280698d10c4dc6e899fa992988ac92c5476f3a9507fc232103c0c90e4386820c7823f696944cb09e2417bed2797bfa80c9e8eb0e2b1a859266ac8416a4a2c219d4f91976a9140f755179ba239f8367e282cf0fa264be3a137f8388acfcbac8e89aa85170008de2412982f2458a0078d45932adb7fa51fd3501592102b7ed45c6ae164de9d8366e725d2eddcc2103c298dcc9f56b983a7189867d368a21033488822f69644d2f0e4f84753872ea7312c0b0ef4bab5019c9821da1837fbd3e21020f391cabe366c3e84a3b0f87ad9ec00d440ccb56ce88b74a1fc547ce20a1f68321022f98a0076e100eeae175b879f39bf4fb04a90b80f7dc5173e619264324c1d9e52102702c0f2ac79c62703993e1a555201a2e6197feb274e6c029f283525dad99165b210310e26b0191b3656a02fe28f84ced3ce9754bc0023744c49d17351f0a8a65b5f92103fef91df37cd5712ee3321ff8d426eb8329ec9cf894ec84e3413a7caabd96c65121034b73420408275b709690abdacbb4e52d5748272d9a09a35967de637f33427ade21034522c6680e4caf1450fc78de6220c42918cac60c478e514aa43a0c009ab52f3e59ae950dda81c8d61834232103715774fa3d6b7097d7278398a48801468c209b2310b5e33b7418358bfaf8fe36ac420ce9cd0b1672df0a6f4b273a91b36b53de0c31fff4cd2418a86ebfb1398852fe72a15e6c3cba3336431bc1df48473045022100842cf1218c0670afc5ce734b5c09e71dd7c5a6e926797fc7feca60f764a1ed330220795dcb61f0ebd50bce4080f54396a3b95e6bb954301f370106728085092d6e5460a5016987676d67d10fdde46e17a8b322d87de498cf2036840f822b2cfb8260d10dd74adcdca2bb001f398a7fc3f5e1ccc8797ec354587e81a8d799bc693b2cce90ae0460488c9d989c6b4fc3b6b109aa4746304402202ae7fe809db978c16436aabbcba866cd1cb57bed1e5e4bc673846f9fc4c8d69402202680cc0bcbc2db4eeb68e1f6ad97dc6ad4e29971e7f35a19d904adea923b996c667e25480000000000000000000000000000000000000000000000000000000000000000fffffffffd76040046304402201ad637b92394c2214c0b3e58e640bd30c5af9da5326374da54378846858edba70220014bb70fca2b610a691a97e9f317a42589e42e87ab50fc606eaa5173d8fdefc9473045022100f11ecd9d25eafac37a349e2f360f2e60c37531c5a81e477d3dc2b28d7ba81fa302202e2af213c51175d574595db73291e0eedf0c7cb52f12422d99e23428e4430ca6473045022100ff24451a87989940e582863fe837598fd4ab2832cdc797a98b6c7a42410bcb0f0220050b6b46bd0f1e5509365d697aa2f822384e9766eaa5099554a2d0e723416877463044022047c1b511c270a6464585500a7ed849405ec415e09e44c8964243c46aaa41f6f50220051a2f426d2aac9cd23a5891de2c59e3a0beb5d24c8b07ec887b80980429ae8e473045022100cff833b776c1bb01ef0a3f652b9463ed58556bd2f8a9fe8ab7fe885d35864f1802205204bed5da1cb014bc654dd5364dbb07a7773d8a91767f998b636d55d4a31f284630440220497eebd4f101899499f799709759826c58dfa9fe8be311d2d9ae828f0ab7ec2d02201c8e2233096133ba48946fe7339aa6f2d1808d8956fc833b5dc1ea3ee0848274463044022028254f4659c715a5c1e49266f6d98a04e4f65adcfe2ff75af3c6b80a9669f76b0220596f7f94c90c115e9f6b9e25c8415cccd5cb04cab02470671549b5593c6126794630440220343eebbdb960ff1c06e1d254dd0f6bf4904d5713ea54cdc818a86d33ae9faa530220138e2bc37569e590d90cc24793e3b8218f2220c15be33be5cafb8727ccaa88424630440220762aac3f639e796fa2b42341850b9255f5499cfb0ba84e61f26f137262399b5002200c994617ef82a7f33700eccd1870bd391729bb05298e8a1ab58c21259f93280b473045022100fdd74fb4ad8093c202c97fafc37e6a9859b010e337ecff804fdcd81fdc3434bd02203039317dd55ec657505a2e6ed216fa00d53403cbaa20d27214f03821b6b17ae2463044022026d4ec27f83981073cbd1af448afb31769de40a60b64e93bff395838f52fc81502201b5d0ea59f6122df641f21abf3766bc37c487af49a16f8fc2f2a1f540768e26046304402200cbe2871b0aa440073965a413d084734ef8072fe36e26757605cf834ac743789022078b7a019e0fc349c0f4c4f491a5aecf637381b24045b4740142e0f435e89daaa46304402210098d2844d368d274eeb1011ff3d0cd1a3ee708d41ec7e71876a101251f68cc1b6021f3bc0bbf056d601ad4021b82f184bbea010a6f567d6bd793300f02498ecdf8e4730450221009cab565e927f774bbfe8a3555b4a6d867d69812c1788f848f27cff97acfa640f02204902037e8f9d043d2f244da86c418706057a3ba119db5c3fbc8f8d6bf9b1705c46304402200f62a03d3cde68fce4962b4335075d6b32f35218a92237ced6c9fa0b66b2fe1e0220196ed3ff219f62dbb22dd10b3ad91c5196f634446b81267370b908a912e6c17f4630440220639e6c511c7d38a9a6366de655c00603ca5a130fc14fdff14d2d1a7432abb885022044a26760f2a07f4bf1a309e721191292f542f9d9546d911a157fef0027bccd35ffffffff9c2403ae59c02e9110817ed29c5f4cf91d57ec1d3414d122f460c21f2adb9297bf55f3ea0025057e6088f78c1046639b63b4ed955562e77f7f629cbaf4b1d4be2e2ced0b018d1e975a8bc5c9af0041c11829795d9d02bdaf081a379b384b49a9c1a893dac768a53f603f4743833baefe7cb88edd787dfd79040046304402206fc6242d402599354978ecb37941fdb4b14a8a9b2c3c9f782730e71e1cea53260220635dbadc58f8b023d5b80905bf76e9cacb9a3e3a895921c7dc22c6e2aa3a69dc4630440220325b128c5820546683fa4171b8f4415b7637106ab131f8b703e8fe59ef32245302203719a06c3ec4527e761f07ff689f776225ffeb84bd1992723275a8e08d6b459b473045022100d21b7d7df64809782fcad9e9b76f77a8f548aaf82dc6d3b9fc54991e3df85322022062f38e37ac33ba7ecc0253744a4a0ff2af9d52062b9fa721a7e13c7a7cc5f69b473045022100ecc5fe7c94253fce3acf55203333576c7bcbb2035429743fcef95ef47f24291c02207b61b895bf2cdba31f277d0dfc5abc6554a6b3dee2e7de79ae0eff1668f0c43546304402206a4c04a06b2ba0fa4d72da30d0d73f87331ce4329499819498b981604cd43fe10220561fd67cd3dbcff2b775f552ef42de8a33065f930870fe55f336d6f428c189d946304402205f2af81c4fa965b8240f2d002f181780c5c8c38f77a943676fc2233dae0bdb2102204ab3da81e6a530995ab7599b754a92458c9fff3cc839f7665bfb5831e035a5a7473045022100c526c14acf0e99d0f1c23c4b88611690005e368e462b2b89fe36e9abd735bbcf022009199362249693a9d2d8bc1a60620eb3bded8204af001ca32c1e583d23e131ca473045022100afa7986936b8c75c55cd82936af06e4d6a02ec6293af889c75e1a6ca3c404c4002205da582888215825f04f03a88050f04290460edd9e4443882cf4af152209aaa2a473045022100c395bf025a3bd5d185485e80153d4a71c90baea44db5bb8fc6a5f6f32d8f08b102202d7cda0394082da379aaab471185c83fe8c4dfd1ef846632a0ab9c3d27723f8c463044022003ae2a17e20d90bfe258ec025622d3197b08647f4633e3cfd54b66379dedf76d0220553450ca976ebc057c6ecb788bc5eb8e010098ada6c4ffe583dbee37ca99975a46304402205795d2c37ea3b7b5b9b92e5c0e418995a6fe75717072842ba25f3656bad4c7f802204d9f6a023a182345345c8ae26ff1e1e11263a815cc9ea58e73601c61c230dfc7473045022100ad73e4ccd1a8ff563bfd7634618e4d68888a586aca6a128159371f78b69673d20220426737e88fe253ea9a85d2fbb12fe3ad9d082490e4a36ea542349c2238761af147304502210095411a30a1fbd6ef0b10ab4687f76fbbfc0f6001697504843a5124edf057f92f02203e1d45eaa45b56ee23bf7d83ab81685975b4490c0d49e738c96baeff148a2e6246304402205abc0ac643fa364f7f255db235804157d124205af82e2fa473d8bb4a7905443a02200d89fc0dda126eab8cd527efa6db5b6477bf82eb01c51e79e43a10d90c907f77473045022100f63be62ca0b94516daa56a183a08c880b37519a94ff21f8b626ec24aa921009302201cd4f1f51a500a07302ebe2feceac9173f923877d1141beae3bc4bf73d375ca94630440220417157dd09ea28643e22fb6b5163a84bc2e6bd43d155c528726600d241694fca0220299a89d6c3ec259e44b973400f6db255f18a52e42a6c62d9359fba0d2184a9cb54fb9e99311f221faba429b29f400f2fdb3c1833b3514baf686c3f1427544ad01c7f276c2414f20a8346304402200128b2bd914502e18cc63e6765573b8105302e76b07e7374ce48c4f0356974e0022053f7324e6eb3bb17f7a6c9441956f87ce0e391bcc7c3fa3fbb39723b80d941ea21024e50dee9358f0df3f21b80f29e0d1bde93f606da2715adfc1af46d8aedde443b1976a914e98e951bdc4590b669d22229ec4ce022d4ab3d8088acdfb81de16a2f64140877ae666028d1d3e6af44c1f0d069b2a47621f9a92ffa285c1d153da1bdfe0afd750400473045022100c74d067d87097f5b9cca436f522ba06b01b6f0e4193a9769df5f7358d78b3156022045de7c6f8f698567c6d6d91e3aca468bb14e2db320d7a7f182efcc4bd4876154463044022048b42559b5072f8bb35fa8000c863d685d5a8c7a5e0396d482930a816540530902201ed5d6a0b01aa6a1cdd27ec247f97c850ec9b0547eadf052d4de16055bec151d46304402203cd4b099a12c13b38e8fc80843c13571180170cfd1eac8812e7ccbd5d2c76a35022015f88503c2dd1f7e433a064db7b4fba81d0bf43ee592c669b43ba3b82eb7d0234630440220215c758518fcb78449522404ad529b688aab3d8e7c7ade095bf9c5cbf96d290c02202d0f02fcd89687bea70e2e7ca49b7d780a0785560a3198ed7df6c933f444520b4630440220360e163ab8412823a5253b1c08536f2838dac8b2a80fe3cc2e2b3e1f5df2aba402203639d70befaa16a4032f7b23e683fab9a22dff834f69a75e701880d9bb59c98b463044022015bab54156dc146bf5a1e0663034730319b446196486f92fc81477ecd303f72a022010d637cc7678a534dbc95fdeaf0641afdb68e82c5113f88e462a3604a8434050473045022100ae91d38077c2859d9c3cee7bb15689b48358b39c4cf0eff3624a15a93161a8390220441c02b87634818c5378e8d515c1a06a7bd6f97a616d71e82995f7267ce4b0a546304402206a6f43abdd26c615693220f3576010bfc85c667f83c7921846fe369883d99e910220570137eedc2344cd65e76551bb872feb6e4adeb218594e8d54f02cc93307613d463044022044e7176554d1f760e40852e5d1cbeac7bfdb9a805e2d8c013b385b02e4a4813b02205bc1b86e0a8604c63a096e5f87b7c04c7af0586a56d251eff676a531a4033fb84630440220063bf6ff87a5508a57e2d2c20dad19e270b1ab7264aa517738e21d3c5dc1964002201d24f476cbef0adbd89c74d1ddf7e72980a171e2b32c32ea66dedb01e49b4ff7463044022029741e5fefb4fab7bb7fbe3084f4d6887aa72d7a40ccb613652678ff880abaaa022026eb6a412d6d946da6724c78b951959616e50343ab92f2d1c722bf54b7278f65473045022100ed5b418a85e154525ad9d0dc8d27b98c00ce215ea13960f696322fa863e9833002205302c11b9116006ce59353659ab24c5cf7e666128c97d714455b17f1cb89bf114630440220316925877b29c00c876e35cc99d76eea2e0b3dfc8bd06abdccc3bdcbd6fd0e24022043ed0bd6681e1a4ba7d187c45b1a59383e137242baaafaff8ab601c38747d1d647304502210087b711b70e09f6ef6004461d9c688909d179a4be3a9574d63e1991afa7e22c3e022021e7ca60dcb515e677bd88319289a001abe26b07415ba7dfa00e70f95be8c6cb46304402201c8eff9a5051a60649ce671d6d31c54c9759c806e157e459962551884e7ea4af02203931cbf9f333f3443701c647afe58d3c06cbb26b141db7477e79c96e4d4d34a346304402201068eaf8e6f39c0a4625ba9349222bff0df0758bcf6313b37468cedeb94de7fd02206fe06ac2de1071e46439f558a35ebf6bf8875f1a518f5ce02dc6fc3e5f611a27665f47e94672c8145cb3e2213531615df2c0aa0c686e19798d215d8597bf59bcc5c9e794a0d6048afd0d0300473045022100810e6dd7464311e36fd702e892cd12581456651281829990fa9b692ed6f175a2022043e793b1da6d5820a3ebea0a22d0f07eaed3c0900314595f34df3e850bbb628c463044022059951b253a3ef907fb29d730442f8575396f041134c9ebcc0904feca33c640ed02207402c95e35eb2c1e2d9e6d6bd4accdf6620be3695bdf3d8212cb2c8bd1f7bc7246304402204e85f8b5a378073eba40f7ff3bb3734cc2a046ea7f060bc76baf65b0e3537faf0220607b544ce22b012d88161ab8083721d6b432badeed1aa93003787d5c76b69d4b473045022100c0abae23c4ba81796792accbaa00197aa97f14d52550a2b82f3fffe30cbd134c02200798af13740a9e3c2ea4137e272cea437398c9175b4d793cb45302ba6743ca0e47304502210091ac09a00ba09ed52c8f18169a84c88ae1e029f7c20bc47c222ebd59dd016f8e02200123051d8191675b1e63c48d223ddc0d38e1fea08358b576423b721c4dc27862463044022043875a601c2e98bc00d121f9dd7618050ac94e766bf8d3a927260221abbbcc6a02204e06c2bf529a9a1b75b160bd55fd73f345d9d40ee3d4f15f984cbb01d267fa19463044022040df323c538e4c9e10cb826507cd3f83aabb0983be818313a66392e82e801a5302200a718775ac7957a9350442df421b3f6059bd6c0a32f7776bdfc6edb1da98993b463044022040f84d8d0305b8164f0a91b7b9d6f2642714bce5fda5faee5ca4ea52720f7de9022054ef4dcedfed2882de7bfdcc2613da52d6aedaec29b84aabe135d663d90b62d84ccf542102db9d09b60d6fcf50d3290e3078173af5b6cdb2454746770d6c86b3677270c6732102089b8ac6727336a8343f140b65d76c8710364b89fae5669dcd8c6aac91904e142102ac196a356bb731f225d7d0005f32b864fb3b35836a3e28460af1a622f1c383f72102efc7bef0150752d1da515c7341b645f59292cdaccc4b7a17e87edf654ac5a4d72103ff059a385cc46d299a24bc5c7737a0c9b083247919062c317bc09d77974faec72102655ff6ff38151e48e7d40ed57bed7b6573e00044c4e159bc25f5c2ac6eab31dd56ae171fbd8c07f06ded9974d5f5c7232102312239452b357f9baa50043c7256211476f9f232e18df78a6b4abadae902a5dbac88dc9ef6847a8f73fd9b01582102aa962262b31bfb5274e57ab580d86fcc0e7cf354d1d6b42cbc9f41a8b79d69ba2103713031e5678adba942aebb965a0888d287390ad48ed0397bc0f8cf60160cd4342102c22bb3c125d0d421b842c41a8c8771def88e2cf26bba157e98b7bf18e74520b82103f0122c7d62fd18a596723a2c0887f680486ca1c1953560fb9a2c6c24a1ee8cf72103a02b0b5714a30150e5ae2024d2756cace2f10f9b33d26b80885ebc30933d090921021ee25cb3f0d378b0afee856d81bbcbca63cfea35bc983b38f8e7648410aecfac210379c09f5bff3d2b7fd6217b4f0dd3772eac005ea4b95a2bbe6c321486628b72ea2102aa4aefb79b03e19dcc6a1841b22bb5c226bf9f4c28902d4bcf4a348135912a7c2102af4252f121827a5d6b5d0f8273521a25cce2e7974519e09076cb796d2d3963052102a73c8370d07ac353040bac2f5e7ee27801190192c8a3e0dac5d0a2b19a72138b210225b5ec15c1a7361ce5a1cd91ce0b302db4c5a50b38e892612054c145717c263f2102fcc0ef0d7b132d3676b8249e4419d98e51dfe63581e6cdbfb751e8fbe7d2e32b5cae6e1b9954fc0fdb2500dcf34b9a5d23f7e70069bee40d9059b48500657a120783c184161976a9147e73483c1f4136c86417440e8d72f4e1fc58d1ea88ac6bedb17b05ed790800558d11f3f42f4acb01c875118efaebb41a2f98d618ec1106e05da749ff89685db0b7d5f8b72341d20df36e04e248473045022100f6dd02d1279300343dcd8db112457f03c15c89c11daa4193428ac2a80cc51d1d022037c66ebf834afdd2cf93e15825a20b64707d7cca329bd8fe10f7a8a207b23810e137ccc003894e32f597b20a381976a914d79d883b0301f03e486a74fa01f336fd0d1faef788ac59609e26c208c8b81976a9141d321f045a5c01d5f55b68fdb12ac95330cee8ae88ac600dbecc141508d2fddf015a2102d6f03e10197ab2369668a655814412f6f5e4303c9d0fbc3bea1407c221f900c6210376ef46775288543df061dd2a2f803e9d85989e6d2dc2429580c05c459c868e842103ca600d30d649b5a750fa3a3dfe3a09f80787b6e9744eba58b87e53103e5ba09821031cefc7bb608359a0ef7422e051c7e19cea0a78e97e15c43dd13ddaf8742298b9210267c31b11df0cdd357200d1cb38c4ab39817de7da3d51b83e844f7e4cf893acdf2103c2f607a37cfea2fe5bf5710d86de41650a8b0eb8f75384b1b2c9609c0f8a06582103b82e19cdfe141147ba7f66e66f720ded742e918dba294c4d198be46db83dcbef2102df6877eb91b595f31e5af9f344a565a0a85cf35ac9c2c752893d3375471ebd9121027d8fb6d39be0d5129030a4af6170d7fd257bc6dd205e14fbfd63754aaed8855f210290218d5c8429cf03fc75f51aaa0f6fb37a22be7ff881655c8fe49a666349b6402102f86b90764a47df66c7942543c0c19ac415c8695189dd01914a427ecf870ee8bb2102431bd4bc4ae39da048b5b568b1aebb5d15809a5b892f78139a8add08cfb199932102591002d24cba0cd4cad2fd0adaa0e02713df5e8a7a6ca96b9795a6210ead17e6210276897ef141aa27ac1f97ba3d56a773f5a7db8c8fc5e29fbbaa8aa356898275015eae48105e8beb94f6ae0a87af253f805370636b637b7d2ef1d6957302107b100a42bb8c917faccf36bd87c70f0ede834630440220127371362c7136deb9e37aeec538d250d67917a22968388ff7790eebd0324632022002aaa8abc49f6b6dbcfda2d57ffebb55cfc05297379294711100a70b9279ea7a21024739035107202fdcb2792f64e50ef6dd9abfd9a25f7028a00f1300e0c54070b81976a914424ec434327e9f08eb8858f2ec81ec2caa10b32e88ac9f81580ce09e2f7de808acc88137777047f886a379cd0ae303c0d4cfbcf816e8c669e56f899962aa6b46304402204b5e43ac0637c47c8e99dec1fdd491e05b26112cca3c47d80bb04262af24527f0220336aa40ea836770e4f132e8f2219d49db0c2d671814f6c07dd1fc82494ab4b0a232102bd252e706d7105578d124c96b252c182fc9682ca94af11fb507878803f8bf7e8ace688407aa930a1f025eccf5aae0e7f640770de99d4f9aab8221b1f8d06fdb11a5d15a891ca0e8c2b48473045022100b396358637f5408a6ddf71a0a8ec64a133ee090db161898b35d14a1d20691513022062823453959072b3970fa2d8563932174bf5dea14d31aa300d2c5369780537a7c523cad80b9e72fb038694a6f4923ac38314a36b334ff0b715e2ae182a35f719640a97ab525700d7fd5a0400473045022100aea47d8bfc8f53b6d936599472382ae1bcfeafd34bac7399770e581bb7a326ad022002ef9626ec3a42d101624e77f2af34720d47cbdf73f38ec2006d93d7396f9a7b473045022100edafc6336a7b0e16124c3a7039211229e2eacb3f7ac57eeea2d5d750859b29c302206f8f8643f10cee515b43a80f6747910051d3a507e244a39513c7907306caa961463044022035ac15c56678d3efc89a36ee35d29813ee777f74c85be23d83e9739727b6334f02202acd3f036b9dd29cd530adc674250afbcdccb0bfbce5fbe9d1ae77472a6fad4e473045022100eb6d5b1f8fbbe70f99ed977eec50ded19301d501d9a3f4b4a06e6649455beb580220024d02fe5ceaa330c8bca15aaa3126e1c6590e4e714b421aa379dc2f1cbbfe2b46304402206a06d6179946eb1cddb36c456228deee4ee28ef8e9e7df5e05ef47350c73d8d202200de03f0f60ed4681f8439432917face05bc4887761a5737c5e2a8bbf97e265d6473045022100ca68aacca09a252ff295548a5ef0a8839658db1ab690f1b259e390f94e32855e02202b9fc600b03dbfb0b76dd625921f6e5bc39656467fa1d9687c0d3deb55aaa363473045022100ac7f77fbd54003c0be2abfe6454aa11d9ae6db998ee5564ca9bcae8775af00aa02206295fe0ed3f83839d2b54850d9bfbf9b938a955c33a23b71fdfda5d56f1b84d9473045022100e30e09b8889f1e281507d12ea7723a8a5a25ce5fe6ec73929e4a94506fa076bc022022ecb49151eba458dedf02c7f1bf0251240ac83c6ccf3df618a9509e6fd082f84730450221009ecdbc46eb636fb73ab81b14d439f22444a5193bdbbf38a807fca677c87de0ec02200d3e3f726a45909359cf4b585ebb86363981e68c8cce9b6deb8d669787a256d646304402206db58aaddbfba5552702f7c44308b1aea9dd494fda54848b35ff84c2c71c8a7002200379ab9584a6de6101a17a4eebdc57961e91a3dbc4ae90b9a73819b073f68f4a463044022030afd384a182a7a8641c37fd673bfe93a74819249e54dbbf6c02e93de0ab6c2f022075512e27ccac64fe2e74fc35c7e351c8db3831fab9866af1904906c4bc03ecf947304502210084cf143e0023124dc27762baa8028293a4f4f60c980e62e9a199abf572fb903a02200e3e60f4f7eef39bea41db931203581ee3ddedfc299721c8dbf2907a241fef46473045022100ca1fb3621ea238721fc6965f7efc3165c30e28fb990c3a5e76d0917eab7f22c202202135d4425f9216007818ec3e9dc05624d31c1bb2d56624f09702e682ae63b79b4630440220273a91a355ac5900f4348f18c60def28232461122831ed1161497403c972446f022044d59600632e5bbc0a5cc843f1a5d7913a75f6629085cc8b5b39f1ba81f5324c473045022100e341c40ea77d26a2da37fad74ae0927e78be3db2bec832317a0b0e4ff516e66d02200f2a39d6a9ae1f343a67c1d1c6f58466731c227dee067514049cef7418476a2125002102d64327814f691a42d3755e238919ed191f2788f7a6ce6c2dcb23139930b8c97951aefae0d75723e1503282b725d3ea2fb64bd7a8564f9b9097dca0040072c3f21221b2f208bcdece988400e113070726646c0f5bd618a638ea5ffdeed8af3e3fd9f1ed0e66f5fe7daad18600961545733cb6c248473045022100d047a5b6bb5f02ee9147fea5ad516e360aa875fd3b58f252051fd442d20b7056022050531b945683cb12e2cf99e2b74a11506905d290b377cf03cc16dc381941aa11ed4e43d41d5dc7a0042f8c5b0c0e217550498552b4d14024cb406c92f41dcedb4f07e6ab71f6ab5f6c473045022100e0500858f38ad3ec59c6271997d54a0f7679661d129c188495d08fc695e587c20220708bfc9ccb872105f6c5aa7d8586dfe9ec82145a61edf38d5ab47760869d644023210291373b7b1a1ae01203ba5ac465ab47ad2975dd46feb0c6827d38bec670d79d14ace63a901a81919b3da3bbdf48602f94df63d0ccfcc8203bb1412e88212b533350f813f9822de75420fd3b02004630440220792d4365a4b433737a83cf75f47073e5266ab28e21758fa5994f7adbe92373bd022061a9def9ce44be09c934469a771ddb0eec559f2e257da0e733f5c05cdc1af78c46304402203a5b0294c6820e652a157a9f241658c632563594e4aaf3937f5f1fd2b7e94df60220625d6dee041dcc48c15927db2a4981c7854dbad62feda43ac084948cb4c37a72473045022100f8c67a99c36a2a73a0edc5defc063a51e426d8fa08b49a709fd96e39700fc2ed02204b0aa14dd4c6000ce9554812afa6c02a5765c41c214f908201328885d25fc3f14630440220784b4d20f4c85bf4b1a68a2683d8cfb7d798909399783005e42c856bd7aebe12022071b66e455d812e13171b675dcd3bbff559a7db42b09fea12a8531f75217b474f46304402200899bb9940e1180c55fba8400fb011ac6e47f52faa54b1d818eda651f6ccb27d02202dedac2049ff98bc142f183b4129a0617f351d8e7224a8ab7a70d6e8fcd982bc473045022100a0e3d8d0848e75d89871199b6b1ecdb5ebbded25cd84b31426a3bcb911852f2b022014eb50f2c2615d825c35c29a05dcef06550b755a47a27f5bddf199312bf432f246304402200ddc04324f0a6bbd1a066477aa6d07af95f2f815cd45fa58c59858af6b525f16022034797d1d71c08dbeba4792cc0cbc9ac55d17fe114cfff1ccd3c4e2cb41610100463044022055331ce180b06b6f79c73c7a41fff0365ea2504aaaa9b9f142be7854f91d2eb002206db67280ff22164606c70a79905eb917247eaf9d5eb5cfec5343b9dd4f6aba8a2b345573014aad6f4ccf7805ae1aed6e5dfd2757458b4d3b4da52f344afbbe0ed076784cf55e17a2484730450221009bfef877e07c3ce100208dd7d522071b364df4270a5734742804e9ac2c2426740220298f95eac3d3e78e71c2cc4e6d8647acf6c53df205eab3e44aa807a7e4daf6a3cf98bc760000000000000000000000000000000000000000000000000000000000000000ffffffff00ffffffff036c30f9dc1d730fa017a91476326fdefe3eb33c3fd2888e7fa809bfdc53423a8761de5c33e996eaaf232103533dc3a1bc0452280cf1f581ef4653716c02d2c709e51d2107f7a96ad68edae0ac2f54e7b569135c7dfd3501002102486f9c0dd1895e81be684a01390943457416dab4f8ee7f13cb6e342c8b0d5f692102ddb8a7ead021bf99170557d9e91787b7d6da90d51a84de5215cf48b0ff16944221037876edc52e51fa062caa4e7954d4407bb5abb5525e720a401a0524a1f4e128672102494e028fe6cde1e42309a83d8fc1e9f7aa23c683647dba1c8902b04f8ab250c42102632bdad1832f3094a27011598434b6dfd3ad5c0e324343548955b9e47699ef202102c179afe6d0a8c7ad74977ba93a31d02b3339a4fa9eaf6f594418b748fda075dd21036d1d97c281eb12ff31d4a3d6967ab5ca70f7debea1541fd827e0b7afe8a93c2c21033f0fadba950ce670f916fd98329295be45de5e3e45f21df9568e9648462d84df21033de867cc52ae1833d035de009b0d2ae72415e51aa33572f751dacdfbc264800b59ae01c3d5a4")
    val txMatches = List((true,DoubleSha256Digest("635f69962abb6e75cc3a94b6c604ad86f33f514eef12a33fefb8ea15389b1fd9")),
      (true,DoubleSha256Digest("62e40ece65cff821b739f2cf310a9917c97e7475153df8a55fde1ea151731f7f")),
      (true,DoubleSha256Digest("889d7ede4ca91fddc32498ff1b7400526419863af3a84da2dcd24cf487fd881d")),
      (true,DoubleSha256Digest("dab811210e8000ac63166d032cc2347a149b2796e10b0292c249f61486e416a8")))
    val txIds = txMatches.map(_._2)
    val merkleBlock = MerkleBlock(block,txIds)

    val partialMerkleTree = PartialMerkleTree(merkleBlock.transactionCount,merkleBlock.hashes,
      merkleBlock.partialMerkleTree.bits)
    partialMerkleTree must be (merkleBlock.partialMerkleTree)
    merkleBlock.partialMerkleTree.extractMatches must be (txIds)
    partialMerkleTree.extractMatches must be (txIds)
    partialMerkleTree.bits must be (List(true, true, true, true, true, true, true, false))
  }

  it must "create a merkle block from a sequence of txids and a block" in {
    val block = Block("2f247158b40257ae05420c51c4f9cb2c0d01113685db8835af6f267c8aaf6f5f4e27f1696fb66c2799a6dd4b1acaa7eebee05f2762470de7bb60891c57c7892ad4a455593e6470192192002342d6255c043728cd4a050e54bcd4f4e7cc7f8d543aabb76d8748cf97c58edce17b99a51865575499cc016dab319000914c24ff6b348213f17befdb73872c4e7ce4934a4f70e0759e12178396421be8837042f81600a1386c473045022100d0b82cca7f8593bf93c120e44e520a275990632ce9b68280573c177c2ee3351202204d3251f0c0857220fffccea2af71a2991a8122f68ff8dc9cc5a18cd683bf85952321021bfea9104a9baf59dc6e92e95afc3fa6b4e1d93a9290fe61345e438daf4d503bac39c431895596a146dc3560e35aa2541f93fda8387790a9ecdcec42be5466acfc3d27c75f96e96b2d484730450221008587e06db9c70b2da9eccca309b29aa7e6ceaa5ec0a839570f900e7ecdac48bc022003b0405653c706eeb1a4a47b0f7bfe8dcd1b5557b9930327d156c429d5bbcd1747c094a58931e83a753240744eb79444f9328591e95fd56f77f4387ffed5aa3b5a799ce40cf0c542fd750400473045022100c1a6ca4ec3b5621c7d9963b52f1985d973f5fbb5a4f50702890996b87b85595202202cbf793d8d0b9c174b057805387d3bea0b1b65cf87a27fa8cf3d8ed8fb039914473045022100f86f17a28b2b7fb8dd458c7507999d4a2477c8f80e1ed4450b55d29631cccff202203851e9cb1e0bf2dbdc8f42dc44c82a6bae99d0a5261126d79f6d982afea8815d46304402206a6a80f4870153024490b826c1bd4f40f6ed91e21039aed3bd5a3e43d531d6ac02205a093b302de7c7e533913d060c461762591cd49972098eda962512f8d9e565b346304402205291112c88c643ad0628856f6c1040b347dba746d889e774ad184f941ec9855c02204121d8d8aad5bd5911afcd730fa075ff987c6618609411becf98b7f466dbb4f3473045022100fae2c8910c0ec0374736097bfa93cd2a866c4dd30ec3af3f102abd65b3a19b46022027de913044cceefcd4c5d812056dea05dd8a69cb235cb794ea14e84e096c5ecd46304402205f00600fb39cf79d0d1c10cf5b232ca0703306240f5978fa37e1a6dd3c6318bb02203423d39d05b0204e0d8a9d90351aa1dcb5645f5a80c566ec90fe35ce4fdce5e6463044022043c663f756ff0a0d29f00ac343e04a9739e3c5a2b059040d387e7f438a4f1f0e02204a7d82941aee47eced2bcf7e522c93e859347f6692425451a2675946ef8a72104630440220682be149764e6997248c8f22a1eef030b0aa094c26b67a63e7e7b0e1833ad7c5022052375d764c759f6119f522939e9dfd7289a87869bed031485019b8d99b25a404463044022068e80e99f593f783dd1d27c007576e49e37b4e1b8c89f969aba271f85c4c267602207381c3fb251d7d9a7d235b184364361ff4423159434d017c84d5869e38f09a2a46304402204c0a4bd6a70d298c0249b446c511ce86def7669bb6b5cc639f1b23f36091a12702202d29c32a8fbd71d33d7a03f494365a9078b199154782da7fe9aea192665fc78f46304402204515f64c2c13f761a2dffbdd487c4df7b657ac34869f1e36a49b096300b150b502203c084affc3af987d9e685b2a3ea0a01a84c9937b5ebb20267c49cf8a64d05de846304402206bc836b700746ce0e1f030f1b6faa9828ff1779cd4f05b8486db9c6ffc2769c40220056b492b41ee40df4aaf6605cab94dfad004a41663159678dab84fe6f2e9f2f0463044022009ed4275fd27d2a120bc2f0bdf69b8cc6fab8628faeefaf9d7b9cc7c18f7b2fc02201560d86acde75fa2a63f1eb40a47bee847dece63622a9cfb1d7626d8747e286746304402203462127f9f5ca7edec6ae7ad47cf2d0744a4d0f8d09f802954a491dc0a77fdda02206d0b1bd886ad7ef5096c71fc24c5fdf4144c0dd0a770d1497465efd2dfc51451473045022100919bbbaf560a34e334832f6440f7f5bf254fcc5d87f1382e0ca8f55b64dc385c02204811a5b9c7c2ed7b57e02acf7c3a55b8c05df9fec8f2f686b34b56ae752f3cf6463044022032d47a6d28fbb14c270bb10a99fb59e5250e7c363a82a82565df74282cea3c0a02207e60ad5a85f091a2eb44574d4d86e8aab21c59595fc05adfd95b2154d717bbc4a8057c94ddd44cfcfa79c8408ef5ca9118dad4b0540d2dc3c07a6245bef2cdc92e2eb932113d069969463044022077cf9ebf65fa531d1ee00593d0b65fb4be3a0dbf5eb30f567757817c03e0b81a02200133c0ef5310484da10ff4afa142f5d86f184d089253dd518e7252f8969ebcc021028b1ac06e23fb71aabfa7b3b1dea7e95558ae98eb7c913c173e269b08862b1e589ee9f81209594e4e4419b089d9255121034a44fe6edc7a32f9f4dcb5cdc52db227f83b127cb88be983350ee6b2156426c151ae25ca21b305587d9dfd350153210213204851866ae5f641ad75350a6fb87638e867a5b747869e5189f3e9147da39f21037bec564897697cd4a2b354643ca0b71bdb17728f1553fd8f6b6f65787a7a91ff21025a803208e92f837d55245b374d6a110416039992f6df32790d4d2cb9733b034d2103d057b615eecf55b9e5ac926c5bcf62e87066a0bb1242c54df1f896a5ecedb2aa2102d43dd3db230a390133d90935b8daf515ed87737003baa2c3913305ae8b41ad41210390e827472d19f448042bb29e853518954b965cf65a8ad2686eb11947c84012de2102c47ed486411aa5fba1c6a456b2b075861e4fe937eeaaa148f00b4b24870e86cc210319ebdd3d2b12afede62650464314c93201e6a5e94593fb4aeedb73b9c114ef402102247362bc7bc5e74a141583cb1082df1a8efa094d537f8de9a9f09b13fbca739359ae34529ecabf27f35e2321020e148ea60e6bade2da1602fffca4a7d67a4b7dcb311c6ba848667386973e66feac945e7ce325bc37cd1976a9147bda69999178c6a4b6d89f8ebbd94d3cbfdf655388ac0500f3fcacc58e48232103494ab432654b3266283bb68cd93d89276f03c86b8ca19ff1b708f4b7cab3f5daac3c42d5603f2ce10047002103b8addae404260839f3349b4b1057742e19f59c1db0fa037cd6ef7393a7b8d1672103873f30fa80e16ba6182fdbced8e5198c867f104ff1cdf90b340932e872af3cac52ae5b673e18f1708dea1976a91413eac030dbe824b5f86fee21e40e758b3b42959288aca0f58ffd54a2e91efd3501572102ae0fdf45bd92bc5aa35df8f5c4d90590cc1c9c389957f059f20522c60791ad6421026a0fcfba1a8cb871e6491370b530035cab26416cb9f751fba029a7fa6297e4b72102097564678faa59c8b6300df3ab709f08d6f2227d96b6c8b2cf01f4dc186572a7210359f32d27fae5ede2183ac8d9e5c3706cf8b93dccfd3bd26b2a2bc996a3534b71210373ce30bf1c574a997a57f1b99e843a7fe9773b4b188fc41cbf0e5fbaa6e1bee321028a864331e90458061dfb027a1ceef1ac75bd380f3cf5c853e4506e42df610c0b2103f858a27a7e2e63b3e012ff791f1b38f75ade9ddde1e461b867ef58f166ed6da5210281c568b5f72242e294056c6e53f809adbaab2117777ce3d8dc68a68793f6c6932103af79ec27072a573b6aabef7c2622e2ceef7a0b6dbe0ba6b82d7d73cec80d314759ae908ebb7f1f5a6d64002a1fdc66ba5086f8032c4572bde4696259bea3cab9c972eb5738be629aa3e81aefc7f08b3d01c8eb263048065efdad010046304402206101fd381adda1ab311d28d5d76a048e8ed22d054d47862514ebddef86f38746022078b298dd15f4650086ec352f40811ec0306ca8c73395e09b1fe5bd1a6d1487c2473045022100fa101e79ec5602d10c1a9c32dc40f663b8346feb95ab7cf610683e9370adc1c202200d06e022c83e15b4ebdebb66c68743075426ea207805871d37bbe68772b1454b46304402204a7ea44924b5b118dff41de8abbd7ed691f45882c3d5f8a4fe36eebd98c691d80220484e78cedf60b8aa0cc5d5dd63c4e805bfe39b9562c0cc5a779df9093541f6ca46304402201d0e4c62ae8e05da56b1ba240d86ec93912fcb86800df6ae055af1e0b6de18b702206d0fdef7ced1374a81179ed185f652daca0c350bb2f1c1d72a449b31c00ecd1c47304502210091f60e4ee97c095d2b6f5528d59c4fb6ee71f19ad832dbcf7fad8ef581b4087202200fbd21511732a9e687b8821665c8246f8c3c69447ea59c15d6d3cc5486938f9e46304402201c5920883f123b2659a56277259dee8a43f2aa5d2c81cf0e821433f61657c110022052c3628a764e201d74d846a609c90357c9e152443799c89ed01eb60e238bbf1f4b03351b90f713efb201281330d93e263eb24ea17dcdc796b553ad296eeab6307a339cae8dcbefa84746304402205379e14203cbe3a91c659fa804ad590810ba7e65bea515b9f1dcbf151d6f8b5902204ca15da394b4ac2ecab071702dc245908029c4e21dcff9af199a0f1a221f04109eb89539c2663d3dfaf41cfa3e4ce85ef2a236d0b745ff61e782f214e394d4c694afc5ff0abc411b4746304402200c97635e6e9c839d0c59011e6065c7a98a84bd812007d74780db07bfeff9d83a0220702da17f4ef2a2718af4694fbff87e7f407b5e4ce8f0ebe7860c29fc0caef4a1a3567464071fdb8fb8d69bef2bfd01025d2103f8c0811cc25c1aee46a56daa050264d3dc1e8085024e769ea81670c99ef398372103971a3da9af94725734001ec7e2c5870c4d9c375738df617d4c03f3ae0a95e9c621026b44c84a2646bfaa47eb595cc1d1f2aef4553e6456a186d4959bf8f695704cba21032e02282c4527294915e3a299b1c05c72e760a134b7ce110eb2315a1608c5447521034d57a263b104af70ea014a850e32d7795243fac04295206419be6547884b79bc2102e772830819c92f86b37bae687833b01500dd2efd8c5999f53dc83c2eaabb8d1b2102d77296b727b470f4c439198a8cdc87e534aa825cae1874ba4dfa6811b1f48ba621034222b79fecb6c68898b8f94b649f39e415b498ea04ac1c8d5e5441aabe5440cf210291c8f2572c8bf1058b0ed7a6010011b458c2b60bb6eb04118ecc3c7c0fca516621023abd9770f4b7c7d6450c9ffa681391e493eef0f60f768fbc06173608ad49ff3921036bc140600e58d6f728853d7a17d819e1ad78cb8cb2fd73aba96fd3390d0cf3872103d581349d55de4e5510cd383d19da4324af8cd9b168af64acbc8dd1ef4d0f755721025f2b33757c607b836733b3017dd65e3abd602469fc5fe152572566f437ea1ff5210353ba1a98a7498bab23f5eb16188b16b3a689ac23322b875a9bfac74b7ba640ed210249efe5b22f7980b650d563a064f68054fe09156a58e79d19e3036486f17bef885fae4896f05708aae9d717a91433674c61ee5bec90093bcf07bf9ddca283aa301b87abddb256c32ca8d41976a914a16bb220835fb8e964866717327cb44e0b3b376f88acf143f0c369d47ccb23210268b11874605075190703be6a1e5a963ff9fc0387d062b0324f70756fe8ef0983acd3ece8c0c87928ad17a9142b5f5920b6b6921c38e93714342cfb0171dc638587ce739c27ac5a817a1976a914bfee48d30995c8b8a35601cd9d5423af02d6434e88ac537329e6f27a89e41976a9142492dbe56951ddaa2e0c4a2cbb811ffded07903f88ac8014cfa3adc7ca0805eccff39ca37d4c53d31fc1955231272cbd6acae0e4d1ddc20384b16543db5365a77a9e234746304402200489bbee20504f3afee025531a8faf30a2aab1b08e2ed431c97e4abb4b56283a02200ce64994a9ab66e9b4e2b2af7ccbf7b6e0ca402ceaf4e29d0f29cf58e0bb14893e1e9371d520369488180440b76d8d5d649cf75875dd4ed84e7e7761bbad3231e51d52601222748f002dc0b72b9c712c458c844a083db6a174078b0e4f4867ce516fdc8ed8f32b21c21162aecfeeddd18a844730450221009f64eb385f84dcc1fa9313ff75e3a8e1665eca2e9a614dae74174aee3c00762c02203946b4a3bcaa8eec2f417abcecff86490739da66a8bf41fee92492174166c9d32102cfe330ee10302da072b599d113ca6a292cf78374788fd5542b76b3803377634e1976a9146375d4a731d767b99cec280ac9376229634bfb8a88ac18e6234226ad6cdde6282a1cd57b441566b00e3d6c9659b6aaf2e6ff540285f92ad5d78f78a030400032188c49e37a4d2de0bb351f5e8ae27bfbf3ffd7cbdcb902bc3eaa71551ba78df3c42edb5281fc78fd920500473045022100972bb873053bcb79d024b17031dec7c5a26a18f1e2214992372c4f15a30f0d16022047d90b0baf211b710f677bb6157f546d9b8ec29777cf8371a4ca52762925ac0c46304402201bdc416014a5c4ed88042c6f3751ab2d3c629cef4885727b615382acffdcbd6f0220158fe55a2b0d802ac742133f8290c8725fe5c5f3e7820f1eb4fd47914377bd2246304402207e8e4769e3bdd50cd01c2dd51f839d6001ddb14178ece9a75dcc9f7e73501cbe02200a5d974d49d88a00b3b5fbc9c1b1a7cd2ee19212179154fe1506a618d7b98b2b473045022100b69fc445f725e93cd3ab99e73e00c7a4ae39d7d419dc251ff7500f5563f4a9fe022026e747c324aff902183c26b1a2f076fe3c3174470be30a045cd444b8508b60c746304402200327444b22fe5d2deeb0f1d6c8977ea9757d783ded16ceb6bc4519e7f0baadbf02200f26063a60c6a6e5daafec38df4d03e62cc25c2dcd3f30efed042377c224e10b473045022100ce8992e834fa3c660e9a7190bae2676fac9d2a2f59bbd442c2e6ef647268540f02206ef2c2988795d92cd06c07817268ee4fce697d296a9644f3285ec7b5be79958c46304402202f60bfa078106c477a324b18688e71ccaa9c0f96ac146b17bf2b9aa007c02149022058080ed5ce256000d9f1cdfac908f95c97ad9110fcfa6fbfae517959e395e6ce46304402203a1c35d5e14017085d03745dbe777de0d66b73914c3ee4e9d54df5797e0a506f02206eb9edb92ed1b5623e40bcc4818dc11b5b85d16cc1ca7a39b62a7a5064dbcc0a473045022100fb5bc2a5ef78fd783371057beec835d72116cec65c099e8c922f9a88027a0136022040c427817bd0bfe59749d5a72b8606d9704bd39a971ca400f12291eef5ee264e46304402207cc201e99ff5243d81b71a4408844d1a0d1e53fa2127b6902763a9c50d95a0ed0220077cdf302cc005d5349adab4c479d711532284f475ae0291e676e25fd13e69cd4730450221008b5db9ef00e5fd11c0d8600610558312eeb0deef4a9cc8c03ed29579586a8554022007d9cf97e14e5eb7ebc178c81b04a227128272eb93813c55ea4f3ba0cfae9b32473045022100a1b8faabbad0c14a25fdf884658dc5808005640a8083cc338802ad45a6611f9102207d0cfb4c7ed2ea2878475a711dd57a6f42ebab8a56765024f823bd06d3eaa7cf473045022100cc89d81a385fd7945bc95e5658eb715faf209f244e5f3398d99ffe4f9ce643c002205afe76f4d46d0a3e3359f20d6dbd35e411e5a38bb19c4c0078e6ed76f2d1f95b46304402200764e5e18694353800907f4f84abc8e8b8cb069f3e6b26c826ce113639b2b91d02203f15940a474f1b353b7c279ed964cfb877beb7d761e52781025e8048ea2d1d60473045022100f6512845b8dc207a3bae030f51df69e2867bb3417a2b12ce6246c07118bd853d02205317ea91e78a0689af1633e75d581589d83588b35abab034697d981cd16a8240473045022100f1ddae4e26d399e6e73193b91e8e11d2b1a706368a216081cc2e0087475565cd02203afdaab247c766cdf1c0c6883b23c2e5db66db4df2aa1b3ecc925c389a8212b64630440220303277460991a5050961837dbbd9c3c1855b7f6733da56af9855f916bd3f64c802201cbef836fd69ca80eec58b62ef0d8cf57d270948cec66f67addc312139388a7a4ccf552103089014ded106cdde33483fd1a361a76de8129d8f200c71242e3dd0fda6cf8f2f210206d8d1f2624f621c3f30b73e3e07de771e665d8edae3426b6f7e2ef1e7061e892103675d0b5afb0ce9b558ed1177efcf5782ba4b055051f8da27218e709b322adb9721021db9cc3065dc738b6bdda3822b3a61b837a1091d629d275f229e711eb45af07e210319b74d8acf6ef64528326ff6fc31baeba4c8631908a757a831a82bfdf696f0fa2103889e2c0381943efee6cd20f5e2078edd918eb7b0778a9499f34e42e21f3465e656ae15aed42f0972d0194b64c2518223210223af4811bbcd4d5982af6960e97e6432500bbf915c038c205e867e1259b02bfaac2702c59e02495735fd8b02011321026bcbf69a06230b202010e1abf7fc5bcbc892a443142f76e349494615ebb33076210280919cb6dbfaf0211f0929c0c3a0272c4c06fa8cf495f532d32d78af8fa2f229210378a0ea90f4a52b12b454ff860e2321e8b24464b2169c468a3e51fa3781751f752103b372ab36fa0fd9d659b3dfe3ad0f7938471dd39c63e10808e09a918b11f5cb66210222fd1005ca1daa87c93fe031a19c99ce4c6b9d3fe4991ac123ca5104ab9372fc2103c9b566ff968c86e6f437064387ba4f8370822ec8fd12967c4113926058e75ffb21026eea3437217135f10def85a957649762687089de77491fdfe1a65a4776326aeb2102a5c88df754e4a19d3af5ac92c99351ae4997c4c5d2733fbde33b2535929d38da2102b03dc2fec3fd28266de13c1b28f656282ff4befa0ee13217dd7bb050a9d9bdbc2103280cfdf0a2842d701395f7194b8a1e32b26b5c73e19657145c7861ffbcbf295021025792fe84ec7f4513e0bc57ba5fc0e46473636f467b0d36832b127845c7482f102102cfeb11d170db132d7491a5d2b3a4916d876bc38199ff47933c3f79d1c89110a2210330410ef6756077904e93bc47ef9964a49890ce29984ed3bf4917dac8fd115da02102e0545f7570469f6784fd934712d5be11226546f7a90be00dddebda83143edc8c2103bc91bfbdfb3b87d9f0759b87404bc984f993aea336807dfbf068f7b7043c7270210347cd4a2f28d83ac8945681006ecd16cb9965ddecbbb96a904648d780d852e50a21023efdb63b827dc0559809975a9ee9caabc2e9022b7324ea0208e433065b7fca4e2102382a86cbdd671fa020ca862bf2bc6c3cb8efa39293826f9327083b70f1657c0521027cc4a3f9271f4c653d9a70ec515150f8ec4d5d97abbe83976b2ac983db8f66e60113ae0298e13d42d9db8cfd79015421037ea59ca9d2ca9add12daa79ac092e39d158048dad303f642bec393c9444f647c2102c433d0a85444e6bce649c8daa8bb010535114ddfec722e5c110d99bb307d7db5210268ece74697769d7f87d3080cd9b6c8031b4c5b82cc47cbb3fcd84d1e2d8f24c021029e78f394ef243ec50572db6b4f40a9e76d6dbad7f6b3a54d04bba420302633c22103487bb90849358eddd3c64e6db5c07a9898f3d9f7a6fe07c62f277abb228f1a3f2103d07e54d9ca3a76a7f857f466c0cb7e5c04df0d83ebcedf879a4d50238ab52e4721039dac049f9bfe92384e7b892ceaf5c0b88b42c1eec171152324ba536a2d84a5bc2102d1d112e97afe393b16ab4d9e5393e5efcc9b06bc5a683b5ac35e618dd64f77c22102d603983c29b305ebc30b4583658e5aaf13536ee7f31c96464ec7a8e6e4a1371d210274a2b7bda8e18d8965f626bf18e321f4ef595b6a28e32815d639d85e91c79c02210366f5694e036e60479587fb0122f4eee6e090470cd4216a844e11a632a6a3a7295baea46f26a20b559c07000efc21d48136770efddf01512103453ba9ea78543ccd0fa820cc7d6c86e5bdc4769c77450696048950b80433dd482102e3500407b5c882b5495c9ed43e2bc0729bac27724db3c7400854dad3183c78c42103a609c6a2b7ad43a310e30a5ce474d275325c587e586db55c43a9afeca4f68ab42102f6b6ffc821f32da645a31c7f86c1588f93bbe17634ed33c658ae459c7c174aec2103892c681ab3d26a4b0695faf43b5dd5f7163cb1e315152e9a735a62add4a84e022103581b752ef869ba3d9cf96001ff9c1ad5178e2f595f1c4681404b9f0217a96f2a21020041a12f5ef5f7238dbea789cd27e04d00b394a40c80506dce977a3660dceb8b2103ffeddcb98ceaa3977ff2548d74ccf9f15df32687f30c145bddfb0d62639fd10b210299aaf75b3b81a8989b72e9098d2f4dc26ac1ff960fd60c3f2628ad717d9cf9332103729c8af8e33f7429ba0d4607968678c7220410692270e7dcd1d7d5aa74560d6e210327a2a6b401740ff6a2add2b350193b22481b521d9cfed6a9fe73c1731670601f21022a3718f7d6027ceb9345a18971cf03f3234101d9cb2b8d950791e9e9f0f9f1f1210374b1b72fa9d29aace7b4b23540d279c4a6570cf41a9a208cd401f6ebc8a3d73f2102750ec475a34a12252b898972fe7ba59d90a036e6c760ef5a26cf883830683c945eae18623342a0ee6b8917a9141dc0a30ebf54ee41686147fb878b8ad83b288df5871cc2702e5c2925420010e1fee0b82f856117a91464f5c6846ef8672bf88fed779612ec0ec7d227cc87cdb001c654de590dfd9b015c2102d6469ac090e7ab0ac04bcb3cf97b9987ab4fc41ecdeb61feef13cae3d9fba6de2102b1280008615f651c4c18379c6e97a1c79861c7e8fa4c6796799bbc40458bba8c2103329ee3d3ecfe908bc64912324ffd6a230d26236712fb57d797538cfc35a52ddd2102ec72cfab6d622a9760ec63e4949aae324af584b7fe83324a4f5c6a4c5972ab0c2103d887e78149502fa74c46c8be462e9bdc8f82672b0de44902c68ba4f67495f96721029d2c2593e9c6521d5087beca492d955caec54233f4923be251f4d9b4e3c853de210268273d4fb018ba275a64e8c03e6f9cebf8ab142fdf53e3eb05ebd507e7f0269621021806fc4679d703e34af058cdf0dd9b7900a0f4ff23465d87b6e17d065438c13e2103e6b4804ae5862804a1f7bd632f5216e7cc724fd2c1b9f27cfaf38730a466964c2103ab5860ae2414cc6520ef1b7dadf7c1e3aff10e1a9a22a8b86a3367deb7f3452d210338b8c592406ac25735ac3d2208eedba2ebaa1e5845bb5531cd97d3954e666ecd2103be6121f4822d9c24d2c86b4bcd1a2e3e2e368716e29bf7a0e044c76e291ea49b5cae3d5cc2c223b54d7f040000000000000000000000000000000000000000000000000000000000000000ffffffff6a473045022100a4fcfbfade4c41c6fcd6e41df15f10045e32f4656258764ab8f805e89d9d43e202206d72cb9c442b61d0a7f27755916dcb893507187372629b1a08ab9c3dc150c1f7210299ac5dc6aaa801175a96809f2eb7a3bc9c8a5b93f71a001196beecfefb8ab274ffffffff2e8385f0c1a0613e5a2af5a50d12712159693487163b0b967f71a76fee56d10ff08a95b54746304402206c2c6128952287610dae1f6fdd1ad8ed5f952cca4160a2d2a00f68420697ee590220727b06013962341ec0e8de5f0b12ae672be69c86b848d84f2db195f55a76719e54b1c98c09b8a7ad804c884630178af9433a7881050d5cfd87dcc8788d0cf826ce43e7cbe1ff6afefdb0030047304502210087b68fe27eabfa4f06b90f41fdd15556dc32fe2acba8c11a710a33160992884902206539c4a13e92297087f3d888318e690e73d9dcd2916a161f9f8ce530e0644490473045022100c5cb35d666e0f0cf68704c0fe714d017d2ea2106483e40058005508f21d9b8fe0220303b577dce39de821bfbb6b56854700bb5bb0df5c147a3e0f214e48b59946422473045022100dd7694c431ad48143ef261d163a8221b87cfc6e589d6b42472a8892d10c52d0302204eaefd2c3378fa72412fa27f360d4790d0e50a8f7b1a5d8624959e015c0c0b94463044022037634adc089b295e97fd4aef7cca8017bbe1cb7de10b84ea9fd0edf549f4525002202fb7d941778b651f1a2d66d431cae3384b35f6120afb65d2d790cc0f16602fca463044022009c1ec813322782eceff706c3ec2446d4f56e787bd8c3c477dbc1a0e0cfa45130220343995339be1da738746256ea572837c54911a4dcbf1ff6ffcb93774bb1d967c4d4602562103658cbe412790816a4c2511025c900ab524e6a736c2399ec5efa42826904961a721027c4649c6a7fe582b3eb79347531293154492c83ba061d90b82876ef23c6bdeda210300c6d10cafc175107683332fe275227f4db0af936a2b4e4197c02d541a41cb112103ff51323f74758952288a78268f1cb18c0524e8a4bf1b40b6a8db2ce8a171ebf22102ea54dd70b6f97972d668666d70bbf4be6893d9f807860066261549384f1788bf2103f795ce50e03e47d21f96aafa41755821d575321760e5cdfe4322aa033a2cfe3a21021b10fe742be0dcc40c462bbd5327c616ddf110073a42dfe7b1942105fd5396342103b8c7734f15ed2e2ba3e70c80675b4d12c6b1001cd87056566b659d85668c3b6b2102375886e4e60a175d2869965d01e9e4737e087d16d73181650c727e03ec9b99e421025f023b82d762a5be722fe4c3cf3cd2c955cf67601494612955aee381e22ab0722102aae5ae83e67e3032ca1dfa1607a8259aae2aa909d9b78cf35f0eb2d82ae84b282102dd0e816c6328b2d482ecf7b32bf1803b33e793e2ed6356dafe1825fec8ce414d21021d254f0dd794346d187a92c4d9ca05e32d6554e11670e9498bc8f7b45cd999082102a3aae8af3162abdfc3a27ee7b55bfa67d18ffc85470b94a9376f0d9e62fa7b762102e5897c4c168fc593ff85dcb403f1295209c3ae9f9037f8ef1a95743e05503b8b2103a2912816bcdd549d59463e483cbf842883560f78bd4f579f9023372dba3b4c1221038c0ddeb41df85099a40d12ef8250336e7888bc6aea598caa44faa2e5812c2b6a0111aedfdce45edd4c460c7fc19c3de7519b83bf919c9173ec535c78cd1b0885def1cbe97b28ae184b524e84473045022100a18825a33f15061305a2f36930b813e67fb44a44f5dab784c31c33208d3e611a02202f5c3bcf823188c78f609ac525460f596e08477676165e5643b9848067cf2f47210206cd46c311d7e6238a8dfc78df0a4b43fc529a9c48df791f62fb8c050b320c421976a914b3497ca1071cea7c074f1df25e6f3023e98a6f3f88ac8b974220091d3b2721c70d582d17a914134fda603971e5b53fa6ad3e1a0f4efe386d264387bc0f0aa280e3a7dd2321022f7065d64cfc0ed9e14600b7cf8286868f0a2c74bfd0dc48957cd4d69117c6b1ac64ece0dc326105d800f21f10289e5aa50900459353e342c96fc617a914ac250f0fac101b360b30f60869d21be637bef8c987b83bad62ddc13ef3fd9b01532103140a1ce712cdefd10cbe46677029653cae5289cd0ccd68b4fd40c5ac079be6a921035764aa7f938e29dfe613c80c52427e577aff53f3469cdc3eb78d055e05a89d472103234042f2c158e9bf71e32db30aba5e2e0b44981ee42e7f0d79c800c00cb4b57421024636c3b3fc5e95a7c575fe001b868b3e4acc93161e67acf28272fdca2b4ddf372103f8833ee5bec14579d23bd987408b9f2c0e67f9188bca483ce814852c06f2b7452103b6c3bfe5bf1a3d0af3494f917bf8c134a0b76e56dcc34d6b56df5f6052fbc4092103b5d0c6f8835171e2cfe9a5d9c3aa4a300b74ce217b10a5522cf23c106bc201eb2103d06eb0806b3a15686c16eef0f06296f5bd7ca38162de3ef303487effe7b5447621025f834a5f1a7811464cd87a129866cb04560458a5a6ff0f29e99b14fa856c9795210246ea1eb112477b8bd702a8abe1ccd9b1dfd2790ed42a57fa6544bcece1b5d32221035163c243f7bcb8e8036f2b2296994057feafed60e140baf10cc1280c52efd3812102f2ce1f1180dcf44490b74f2a8d9af6e96b11321c9586cb674f3adcb7bccd48fc5cae102dcb7ca5c42b351976a91413a5d7d8aa82aa0b3077db3f9b7bb628e222ac0788ac8ba5a74c5fcb966417a914968ed5ddd83d344f340d5736c76ab94ddebc84d387860d9fb0b0a9a15500a3fe04c9")
    val txMatches = Seq(DoubleSha256Digest("7e7f11df739ad846b757b8b7f20fc2c9e1311284b3c209b855830ae9ae204b49"), DoubleSha256Digest("6605d7be8e606e64ad9e4ac6eed7c515f4f543c8bd8d09f09d255fbf7bf48f2d"))

    val merkleBlock = MerkleBlock(block,txMatches)

    merkleBlock.partialMerkleTree.extractMatches must be (txMatches)
  }

  it must "create a merkle block from a bloom filter, then extract matches that matched the bloom filter" in {
    val initialFilter = BloomFilter(6,0.00001,UInt32.zero, BloomUpdateAll)
    val txMatches = List(DoubleSha256Digest("266aeeb4e2b8e6646218c5027480170ae68d19cc74bc2381aa0595ded52b0d14"),
      DoubleSha256Digest("92461b83e7601e4b912815b3fd4b112f1b2e357e88b273e95caeb4f20ebba4af"),
      DoubleSha256Digest("bc0481052ae0efa952b6e37c115766b6bae2efebd236e1bbbdfaf025dab02d16"))
    val filterWithTxIdsInserted = initialFilter.insertByteVectors(txMatches.map(_.bytes))
    val block = Block("887c8f96315ee6920acc3dfe8edeacf825228a89e1d49da0f08ee5f7c96f8abf2b37a74d829f107c92c51221514c6bac2cb38dae00fde41d6ec9bcceffd3ee6de1c4a3dd24e4b653f2946453e480f5d904a990495c065e2c3e5aed041398a52e41faad8a0587b75d5f4ec7990456a18ee17f4d8e0af6145b18d700398d224c0000000000000000000000000000000000000000000000000000000000000000ffffffff48473045022100be2e9aeba58510af05a4167f5d76bb2cc6ed106c9ea96519e5342c394952f74402200be2089c7693e4bc73b6e7dae848096d72b5a675636a4cd0717e6658080fe383ffffffff0000000000000000000000000000000000000000000000000000000000000000ffffffff6b463044022012e57cdec8b83326cd88ebf1e5389a033516d048f22392707f9565667eeb7f25022030554902e2e7501f9f3773dc794b3e964d58a30bed0ba95f23890af1807fd095232102afee4c42dd10b8472403c85d8940a2c80c96d3316ec04c9981137c732bc8380cacffffffffb6b5f8b7b06c8695278e18f589f7aab568f0227de0c8c72eddf578543d541feb21210aa76c473045022100d01f639e630c74a058174e223bda485c6dd771664e5330358ddc858c9a3f200902202ca3017624b36928677bd66e0241f3a95e6dbba58571c5c2ca78507b5803d7f72321020a60750372456735b75b890025d1d62bcfe92f187c073f0cd6cabd358efe131fac39fde36fab34f924dfc3d637c1e1eb1127a9bbd5cac02262197e5511707ea0c2b729c2f136c821a900a3783cac1e4bb48bedfd31d883eed5763be4501d0dc6c79f8c65c4eafb92cb70d43ce3236888da07fdd30600473045022100c4007b453ba6300877bfeddff917b9339c36bb65805a08fe524b37b01c03068b0220554523357d993ff94a1d6dad4f7704c017c365d1ae3c2e206be7c9f5276d31c2473045022100eb7dad7c329428b3c7a554b45443eb3acd298362546bddc5e2417edb9e895c20022078e6b8a97bfbafdcf30914f576aa523991f924c70368ec1e2facd61fac35e4ea463044022075e2144b07f4db93287b439ba080ed71bcfcbf391d2da71888217a469dac9cfc022050e2e6c674433df799b69930279e99b9b18cc01545fa63753918953ca54c18e1473045022100ec7d53d0dc89fe30885349300b99b7eb1cf15830ed811a196e80b5eb8e3c30710220415f5b9370d7a8fa516eb3b7f213b863a92b0b737b243245b23a878df7bb95f8473045022100f29c0274997ebad5a652e3059d1a54e8a3f4157188d1fca1726310148e10621802201e6f5510af7097606914443900ce5685e172caa42d176166e1766c6a3744a06d473045022100eb11155333f6864bed6de7827ede99fd471ba30907130b0a3cdd4ace9f67ae740220142a21ef47283813e6555602fd06ef8c5cbfeb9833f42bc04e50754eaa4849a6473045022100d117607d2be1a000b543d6806f7f6b32b397828c7b305c024206ac98a3ff362d02205770c11d73ebeeb8f8e108a61fcb5893d15c271b86dce5ad1011fa938168e628473045022100d637b961fde0bcfcf0c29cdfe5df86b4f6365e5d0f3455fe1b83e58b7e21e218022059fc437cfc402382bbbb803a251a5dc3770c12de56c600a68722a3b0eeca21d14730450221009629540995c916d05b3188c299c0708a60cdee0c0c71cf7b0388940e79288ac402202c689be5c26d1bb042c178f98dbed8662047431d9b2b6e5b72d7f38ad5d366ee473045022100fbfa297685af28fe931f6d7092c56938b6b1b1026e3cbf8609be302da135be0b022068e8612193589491e4b712cc36f2246782926812d8bd6d8bd5fdb99e34756ae64730450221009657c1ed74c3faf6c2806697243e0b2ffefccbf70d93949f141a30c82934b1590220515b94a0d5a756013ba06878c5e25d1a725d842a43a07681961dc77ad9f8267446304402201ed2016b2268b055782c54552b960c0b5f2840b2f83642a77708d2b7910a47ac02201396bd8fb783f1a8cdea0c1ae7773d18539b5fff997dbfbb7fe15ac068a7bd5b46304402205a1969479cf140639e1bc9fb1b71f7090746726c30d1bc46b34394877c2879fb02205cfaf07faf38961b11eb1d31d5f147eac3d2f7ca6436f891a4532446b5a05bf34630440220117d93355b117de897078cb366f289b3699508093f1ca335f613ca4a9f0fd93f0220014ad36491b03174af20e30244549afcef57fdb65a7f144d272b519349a5ab9946304402206812359a0511e12a8f2a04c43fa258f67979a7cad7ed19f18157aad2205b280402205abee40733664e3a7455d2928be119e991eef9244816b88159b10ab5424e9710473045022100c0b3dcf69485996c131ca2749cee700825e24c075bf17a4825d3c3f074eb3b7b02200f283abf1de6394a920bbf7f6419207ad5c1573989013e02094b2de2320482ac473045022100de4d5ce21bd172504d0fe85485be46eb96a290c4001ee5efa982fa374ef8bb170220580e8e21d755208bd7110bd0e432767b3fdb117d6a2c085b2ba4871a1db8a051473045022100a0b9f8e0fa8fab2fa448568a75aa639c70907e192d10b399c3da17c7ebf05bae02205dc7ba7932125c9c0b61480562c167e222b772bafe6c21c9a1b963278b44f2e6463044022027029b091dcfd9a560f2718c251785ad1cb470f1f89b30e2abf86576d81c1aa502203b49f1b9834bc9317ed5c1e804ff9f71c5f0081ae4bd4265fd27165c6be25015473045022100c7f6674704de5c8d3845763180d39980b3a353fecc7f588aceffef5c1429408902204e4811985f97f5de781221f6a27902ab150796042cca01127d92494716e0b6f44d350100210355f201c2b5abf78b834df937aa1ae761cf7adf2da9743b0280e20ca8f0327cf32103dfcba703b2b1655ea9cdc2868f1d7d4cbae336b0e5989c374c045fc10936a4ca2103ab68d3f403ede3e8a20902a81019702f6a3795f2c98d65e8a40d72c4b2c83d7c21038c69da913f1abeb3b533aba694fde358dffc0d832a8eee6488bc09008785798921025dd18ec3ee31a9ca98bfa96dd9cbe8f6a0dc4dbf71e70a2ec3c74dbc85e4175a2103c7b7bfb705ac7d37ece1e6aaf439b0d2e50f168170030320dd91669e1c6dcfc32103456c2b89921e8939641594e3bd1ffa06b3a6eee51c43cf298733814880791fe121030af71b0e6d0a78c1bf72c71c2a94fac7235060ff3271edbf06a9e1fbe1a0a5d92103e2898272229b5cb84eabd9282f54479a2335258056001eec7d60a7e18791d98d59aeda554df207f3b1fe186616cbe117a914ac5003eef3644d50a72a0fa9c47a9d742e401f8d87e9614799ad8ae6e81976a9148fa73febc2527239fb638299a16bc34020ce482b88ac8ab0492fb98a5f4b1976a9147604735aa700f59d8499fc0691e7efa72855358b88acca279f9fbe04ab1bfd7901572102848a13f904eb9e5817fe12f00826a3487a08f5de484f0b0c9ddf6359987d49372103cb7ceb20fc71f85301b544fc570db072abefc90ccc126473c5eecf9a07e3282d21021393025609afc502a11197e4a78cda287aabebcc8e6907600c713b6493691be121024b3dd5f6e9eafa6b940fd5ed20ed32b66d039a9cac3936854442d38f21ea71222103304b87633e34123f7b6adc9b17561ba4fc0095a1f56074990d24244b2d0f8456210203556cc22fd170496a49796f4348c6c9d5ca4633b254a056f46a0340d800a148210272b644c5bf2671b89d371b783e2fe59e216e9e64b7641a348493cef4e539e1282103cdaf3ccd60795bffec2336996b127b8c3f726787df0ecee91f44deef1faac0e42102c6b657dff2a196b54407ebb0be6c718d1fa7e49011c62b569ee14dfd7030fe3f2103c8796aa3de63704b137ffd70eb67aac50783c072895f47c43f564e7d5a63a35f2102dfb4f6b5ce6a2e60cbd7f61f85d592067c29c3c0f720755ba107a0c92e6bb1535baeaaaf7283d75c5d1117a91418cfed2544dfc440a1c8dbe01912476481853437877388d8574b6373f02321035752321b67acec5619916f22e8aca3a064cc53ae6b479677f3af55c465556250ac1894827104d0939b232103ae0367f34ca494b8a455b9cbbc2987b2902514bb3928eb6459e6b8545234c202ac1b859e789bbb85da0219cb4fab5ac288852ecb663318f209899c095d07db0a824a819b11b9ea8973892267fe3969463044022026e659e0dffaa15c9138ed0d5a0f8183c2b39c5efe1cbe8ae457725c07b7cffc02200619d4ca8085634a2f8e14aafc0bc3912371cc9d92eb14bad0a0b07092219fe82102dec995876cbe0e2aa63d9918c6efef2c82be99543f2e507348e4c54b433bd78acb67c35fcaeb0c5815bd7f5e7749d279d5c8dbf2058d470fd3f145c7fe65803510b2155306ac32b248473045022100ea49564a0a611425c867fe50be7d5e52a81476b08b2df8cf212161eb2abfa20a02203bc5c879c52f79826f671c4b4afa8b045467fd7ac99b0a2d4a076e9f3e33ed86c364110f0269d6f5bbb7ad6a3a1976a914d2c7bee052151a6ac7abc8ef2ae3473e23ee32d288ac14d158735771863c47002102a5efde88a25351b29a0f298deff0787741f2e5e6cec7b530675a55307912599d21036f3db04fc7f9470513c1f4f3847955321c9a1ea9569a20217976668a6c69ee8e52ae9e81e0e84eadab21045501b4d66a2b88b91f6bbe4cb4630d3996d50b03fa90dd119ee45dbea2ddcf635d91b2a8009713e25072558da4ec072266dde652286160eac74f670d94a68e83ca190d2ab38ec9c9ca2898b3b348473045022100a406265c19c9d1f41244c1367b9691719eea9d9d7b00fdb9900de75ea6530fe702204a85cb59da30bc663c99bc984f127364b1c4e0669af8205b144e373a7f789309214a20d75df6e0e2761359d30a8275058e299fcc0381534545f55cf43e41983f5d4c94569d8dc1760054d64086b676355bad83d3281ced0346650e25902120fbed01c0acbbd2afeb6e3cccc0ea326f6f220067f9d984089afcbecd9bc01e288b00210285ee2696c0b33d96f533d1ca0e53322e0d9ee4d42978bee55ec939e75e0ea98521022833f49a724937f0fee99e2d67f44f0aa78c90fcd835d0fa28918299af37b78f21032e157a22bd26b8cb2f5fd0f591775b7d288c84fda388229161e119be13607e7021036b6c8e2af0ead63c9417f101ef33b50d921bfcce82ec0e902abf8cdd54b8511154aeec6eba886e4f221247002103bdbc5b680f046d08c7109c32acb2fe600584f3aad29ddf9b0bd91dfe1ffbda7d2102add04cd10c97b2643d91198dec636886fe71e564eeaa3d227b420cbe9aff23b452ae4fbace44b2b9958b1976a9148b80bb21ec40dd72d1a9d7c7c016d06226d5112b88ac729199551e0f13cbfd57015321035c9d266b3d9fa493e8b65e2731a290267832d52b1a2e6945f2a0ad27f1b1d0c52102b3008a496a2b53d3a443f986754ed685ce84812fef072faeeef6c5af19fbf2ce21031d26837805c45be45394c363c7b68fad46f7db999f2b19dfb5aef0adaf28ee6b210321f9b813c6aa857fc23bda82ca0ffc8d694cedefa50d01799105a20fffc162562103b497a9127eb68cf477188a3104f5b5a9c87d449c0dff435d75cefc3bd7cdf6032103690b70d25af7be2c32241cd790124ca907766c962ef00c9e37c74d3190fb571a2102d90eaf34bdc9f2d9be3f86adc28422e42560e3f1c91f9a1e2137dbddd3c030732103cd6e31d4c46ce39e352974bfc36ce201a379e45421f9aac9ff9f431dceb91c052102a4c7d223d81e6a35e26d5db3e6ded6488c91aca18b234abc23dd31e596a7899c21026b5020bbc7d49d82f9008a665cc31bae04074179750625b680d13d3ca59600835aaebdedeb5d146f3b3c0069b3cf14a03497a32321028c2d3a4708a7a5c40a7e622e3a0dcb8f9480c84c3fa123fca5b2b6e9b7a6fe46ac4ba26fb069bdb608232102169141342d1a65e5f60dcf7b6a96f648c148d1f606dee0c61f94d6a6a920fce1ac063c760a13bfd35f17a914f3d6141c10d328f812df134eee5d472e6097f41f87e0dc16b805e9723105daca73fe427044da780d8c447c70b5d377298ffae7aeaff70c839710ed610640a720750669463044022046eb81d4d8f2762f58c7be81d5174c54bdeb080dd49a1aa8a8ff3eebef6c781a022049387733430abd124788f54bf318243a411c66105777b5e65f49a5a2b349a922210242fbb90fd600030f6393c82c28f28ac7192f1dbe3814cb6e43c40c4af560a93b1f71d6f50000000000000000000000000000000000000000000000000000000000000000ffffffff48473045022100f3f79188992ed1441b5757766d081b98183cf0621e8e7a0fa5b237e6b418da0e022018cc73179be917d65b88daee9599efa33a975c7911c8f5e7cb4eba539e8b8c35ffffffff0000000000000000000000000000000000000000000000000000000000000000ffffffff4746304402206701c863888b53992e2cae5836d96f436e6bdf7131eff0c376a6d7b864af097b02207adf8007115e2454c9e77ae510d2c75be9f4246d00a59e54cad1e5b2eaf9a75affffffffa78f8a1343fd0974c91e8e5cd32d3e5850cfccfc845ff9bc042ffe0f519d6480396f3d02480046304402203a775aa122d52f5781d72c4e77a07d0fd397b026957cc381ae9ae1e6e9b861f202201c70235c0b5a144d4e713c191430c4cc399d6ebdcf09e4c6db929a75156047752a012626610e2ec0f7bcc0a3da2b22db840fdba3267b3077ca441cc80c3d4dd93927beb8fbcaa0ca6a473045022100be64701085b771327e386bcde17c1b480d0cd5802df1d658df1f0e9d8b057f6002201a5840f2c2b1f24c8d371eeec40c92226c11734045198ab92ef22ce818da3ae52103df30bf86e3bf077d1a8ea85bc8dd9d323ea72ec3fa82bc0f3424dddfe7221f7f14d13a850418e76d149c4db4b21976a914ce7f4b19378b353ea8f75675d2abb8244c812bfc88accf4b5db323d165aa1976a9147683f0855a06dc3b24b035951e0a1c521eff96e688ac34cccd7d958a199817a9148d37c78afd9d80042c4c6aa118aea630efd6ccf187cf1f9692e7037d2f1976a914fb75d625401fb73c211b5301b994ebdd4252da2e88ac6b2c4a14")
    val (merkleBlock,_) = MerkleBlock(block, filterWithTxIdsInserted)
    merkleBlock.partialMerkleTree.extractMatches must be (txMatches)
  }
}

